# 批量删除作业功能实现计划

## 一、前端修改（job.vue）

### 1. 添加多选功能
- **添加选中作业列表**：在响应式数据中添加`selectedJobs` ref，用于存储选中的作业
- **配置表格行选择**：为Table组件添加`rowSelection`属性，实现多选功能
- **添加选择监听**：监听选择变化，更新选中作业列表

### 2. 添加批量删除按钮
- **位置**：在"新增作业"按钮旁添加"批量删除"按钮
- **状态控制**：当没有选中作业时，按钮置灰不可用
- **点击事件**：触发批量删除确认对话框

### 3. 实现批量删除逻辑
- **确认对话框**：使用Modal.confirm显示删除确认信息
- **API调用**：调用批量删除API，传入选中的作业列表
- **结果处理**：处理删除结果，显示成功或失败消息
- **列表刷新**：删除完成后刷新作业列表

## 二、后端修改

### 1. 实现批量删除API接口
- **文件**：`e:\Project\Chet\Chet.QuartzNet.UI.Github\src\Chet.QuartzNet.UI\Controllers\QuartzUIController.cs`
- **HTTP方法**：POST
- **路由**：`/api/quartz/jobs/batch-delete`
- **参数**：作业名称和分组列表
- **响应**：标准API响应格式

### 2. 作业服务层修改
- **检查现有方法**：查看QuartzJobService是否已有批量删除方法
- **实现批量删除逻辑**：
  - 遍历作业列表，调用单个删除方法
  - 处理异常，确保事务完整性
  - 返回删除结果

## 三、API对接

### 1. 前端API配置
- **添加API导入**：在job.vue中添加批量删除API导入
- **调用格式**：发送POST请求，传入选中的作业数组

### 2. 后端API实现
- **请求参数**：接收作业列表（包含jobName和jobGroup）
- **业务逻辑**：验证权限，执行删除操作
- **返回结果**：删除成功的作业数量和失败信息

## 四、测试验证

### 1. 功能测试
- 选择多个作业，点击批量删除按钮
- 确认删除后，检查作业是否被正确删除
- 验证删除失败时的错误处理

### 2. 边界测试
- 未选择作业时，按钮是否正确置灰
- 批量删除包含正在运行的作业时的处理
- 大量作业（超过100个）批量删除的性能

## 五、代码优化

### 1. 前端优化
- 添加选择全选/取消全选功能
- 优化删除确认对话框的提示信息
- 添加删除进度反馈

### 2. 后端优化
- 实现批量删除的事务处理
- 添加删除日志记录
- 优化删除性能，减少数据库查询次数

## 六、实现顺序

1. 先实现后端批量删除API接口
2. 再修改前端添加多选功能和批量删除按钮
3. 最后进行联调测试
4. 进行代码优化和边界测试

## 预期效果

- 表格支持多选，可通过复选框选择多个作业
- 批量删除按钮根据选择状态动态启用/禁用
- 点击批量删除按钮后显示确认对话框
- 确认后执行批量删除，删除成功后刷新列表
- 显示清晰的操作结果反馈

## 技术要点

- **前端**：Vue 3 + Ant Design Vue，使用Table组件的rowSelection属性
- **后端**：ASP.NET Core Web API，实现RESTful风格的批量删除接口
- **数据传递**：JSON格式，包含作业名称和分组信息
- **错误处理**：统一的API响应格式，包含成功/失败状态和错误信息
- **用户体验**：清晰的操作反馈，防止误操作
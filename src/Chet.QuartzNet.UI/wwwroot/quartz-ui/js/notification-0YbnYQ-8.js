var e=(e,t,a)=>new Promise((l,s)=>{var i=e=>{try{o(a.next(e))}catch(t){s(t)}},n=e=>{try{o(a.throw(e))}catch(t){s(t)}},o=e=>e.done?l(e.value):Promise.resolve(e.value).then(i,n);o((a=a.apply(e,t)).next())});import{bW as t,a1 as a,c6 as l,cn as s,bG as i}from"./bootstrap-BadVN9sI.js";import{T as n}from"./index-EpWeNISZ.js";import{M as o}from"./index-CiA9X-jd.js";import{D as r,T as d}from"./index-NQclCTRw.js";import{a as u,R as c,C as p}from"./index-Cn4YNJfq.js";import{F as m}from"./index-CivAdk6l.js";import v from"./index-BSNBr20x.js";import f from"./index-CDEWuxHF.js";import g from"./index-CGe3sslt.js";import{T as y}from"./index-BQm8TjL9.js";import{_ as x}from"./page.vue_vue_type_script_setup_true_lang-DP_Amf6O.js";import{a1 as h,L as _,P as j,E as k,f as b,bG as O,aa as T,bc as w,ai as C,aj as I,ak as S,p as z,a9 as P,aw as U,aU as B,as as F,an as M,ax as R}from"../jse/index-index-Cr7_Iy4w.js";import q from"./index-B60pR-nA.js";import"./colors-B7qYdav-.js";import"./shallowequal-Cz8Fa_Xp.js";import"./Trigger-84iPrD0t.js";import"./ResizeObserver.es-C7U_o75s.js";import"./_arrayIncludes-DqeOlflt.js";import"./Overflow-YWJLS19G.js";import"./index-BiGGUOep.js";import"./index-BWx2voRO.js";import"./collapseMotion-B8Lieczr.js";import"./slide-DRHo-HhO.js";import"./index-B6bzgkY9.js";import"./index-CNoCiUIH.js";import"./BaseInput-Dy05JdzI.js";import"./isMobile-VPrdNIIw.js";import"./DownOutlined-CdPTvWsS.js";import"./CheckOutlined-DTccDwD4.js";import"./SearchOutlined-BQRBTVxk.js";import"./move-C4bgQOQJ.js";import"./index-BC6VGsar.js";import"./index-BNkj7F8O.js";import"./responsiveObserve-C-l2EFpW.js";import"./index-BWMVVXcc.js";import"./useMergedState-BIlYqaPD.js";import"./index-CvW6D6FC.js";import"./Checkbox-CmMpPyr_.js";import"./FormItemContext-Br2xbg7H.js";import"./Dropdown-BBJyOr0O.js";import"./index-DXXFMsAT.js";import"./debounce-BQNges-p.js";import"./useRefs-DktFujrz.js";import"./Col-o6Q8T3dC.js";import"./useFlexGapSupport-DxLOHxJe.js";import"./isPlainObject-DoKaImFs.js";import"./statusUtils-CmtbPfm6.js";import"./EyeOutlined-C3ItWeA9.js";var J=(e=>(e[e.Pending=0]="Pending",e[e.Sent=1]="Sent",e[e.Failed=2]="Failed",e))(J||{});const E={class:"mb-4 flex items-center justify-between"},G={class:"config-modal-content"},L={class:"form-section"},$={class:"section-header"},D={class:"header-action"},N={class:"form-section last"},H={class:"strategy-grid"},Q={class:"strategy-item"},A={class:"strategy-item"},K={class:"strategy-item"},W={class:"modal-footer"},X={key:0,class:"notification-detail"},V={class:"detail-header mb-4 rounded-lg p-5"},Y={class:"mb-4 flex flex-wrap items-center justify-between gap-3"},Z={class:"mt-3 grid grid-cols-1 gap-3 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-4"},ee={class:"info-item flex items-center gap-2 p-2 rounded"},te={class:"text-sm"},ae={class:"info-item flex items-center gap-2 p-2 rounded"},le={class:"text-sm"},se={class:"info-item flex items-center gap-2 p-2 rounded"},ie={class:"text-sm"},ne={class:"info-item flex items-center gap-2 p-2 rounded"},oe={class:"text-sm"},re={class:"detail-content space-y-6"},de={class:"content-section"},ue={class:"content-card info-card rounded-lg p-4"},ce=["innerHTML"],pe={key:0,class:"content-section"},me={class:"content-card error-card rounded-lg p-4"},ve={class:"code-block word-break-break-word m-0 whitespace-pre-wrap text-sm"},fe={class:"mt-6 flex justify-end"},ge=i(h({__name:"notification",setup(i){const h={[J.Pending]:{text:"å¾…å‘é€",status:"default"},[J.Sent]:{text:"å‘é€æˆåŠŸ",status:"success"},[J.Failed]:{text:"å‘é€å¤±è´¥",status:"error"}},ge=_(!1),ye=_([]),xe=_(0),he=_(1),_e=_(10),je=_(!1),ke=_("é€šçŸ¥è¯¦æƒ…"),be=_(null),Oe=_(),Te=_({status:void 0,triggeredBy:""}),we=_(""),Ce=_(void 0),Ie=_(!1),Se=_("é€šçŸ¥é…ç½®"),ze=j({token:"",channel:"wechat",template:"html",topic:"",enable:!1,strategy:{notifyOnJobSuccess:!1,notifyOnJobFailure:!0,notifyOnSchedulerError:!0}}),Pe=_(),Ue=k(()=>[{title:"é€šçŸ¥æ ‡é¢˜",dataIndex:"title",ellipsis:!0},{title:"è§¦å‘æ¥æº",dataIndex:"triggeredBy",ellipsis:!0},{title:"çŠ¶æ€",dataIndex:"status",ellipsis:!0,customRender:({record:e})=>{const t=h[e.status];return{children:b(n,{color:(null==t?void 0:t.status)||"default"},(null==t?void 0:t.text)||e.status||"æœªçŸ¥")}}},{title:"å‘é€æ—¶é—´",dataIndex:"sendTime",ellipsis:!0,sorter:!0,sortOrder:"sendTime"===we.value?Ce.value:void 0,customRender:({record:e})=>({children:e.sendTime?O(e.sendTime):"-"})},{title:"è€—æ—¶(ms)",dataIndex:"duration",ellipsis:!0,sorter:!0,sortOrder:"duration"===we.value?Ce.value:void 0},{title:"åˆ›å»ºæ—¶é—´",dataIndex:"createTime",ellipsis:!0,sorter:!0,sortOrder:"createTime"===we.value?Ce.value:void 0,customRender:({record:e})=>({children:e.createTime?O(e.createTime):"-"})},{title:"æ“ä½œ",key:"action",width:80,fixed:"right",customRender:({record:e})=>{const t=b(o.Item,{onClick:()=>Le(e)},"è¯¦æƒ…"),l=b(o.Item,{onClick:()=>$e(e),danger:!0},"åˆ é™¤"),s=b(o,null,[t,l]),i=b(a,{type:"primary",disabled:ge.value},"æ“ä½œ");return{children:b(r,{trigger:["click"],overlay:s},()=>i)}}}]),Be=k(()=>({current:he.value,pageSize:_e.value,total:xe.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} å…± ${e} æ¡`,pageSizeOptions:["10","20","50","100"]})),Fe=(e,t,a)=>{void 0!==e.current&&(he.value=e.current),void 0!==e.pageSize&&(_e.value=e.pageSize),void 0!==a.field&&(we.value=a.field,Ce.value="ascend"===a.order?"ascend":"descend"===a.order?"descend":void 0),Me()},Me=()=>e(null,null,function*(){var a,l,i;ge.value=!0;try{const s=yield(i={pageIndex:he.value,pageSize:_e.value,status:Te.value.status,triggeredBy:Te.value.triggeredBy,sortBy:we.value,sortOrder:Ce.value},e(null,null,function*(){return yield t.post("/api/quartz/GetNotifications",i)}));ye.value=(null==(a=s.data)?void 0:a.items)||[],xe.value=(null==(l=s.data)?void 0:l.totalCount)||0}catch(n){s.error("èŽ·å–é€šçŸ¥åˆ—è¡¨å¤±è´¥")}finally{ge.value=!1}}),Re=()=>e(null,null,function*(){Oe.value&&(yield Oe.value.validateFields()),he.value=1,Me()}),qe=()=>{Te.value={status:void 0,triggeredBy:""},he.value=1,Me()},Je=()=>e(null,null,function*(){try{const a=yield e(null,null,function*(){return yield t.get("/api/quartz/GetPushPlusConfig")});Object.assign(ze,a.data),Ie.value=!0}catch(a){s.error("èŽ·å–é…ç½®å¤±è´¥")}}),Ee=()=>e(null,null,function*(){var a;if(Pe.value)try{yield Pe.value.validateFields(),ge.value=!0;const l=yield(a=ze,e(null,null,function*(){return yield t.post("/api/quartz/SavePushPlusConfig",a)}));l.success?(s.success("é…ç½®ä¿å­˜æˆåŠŸ"),Ie.value=!1):s.error(l.message||"é…ç½®ä¿å­˜å¤±è´¥")}catch(l){if(l.errorFields)return;const e=l.message||"é…ç½®ä¿å­˜å¤±è´¥";s.error(e)}finally{ge.value=!1}}),Ge=()=>e(null,null,function*(){try{ge.value=!0;const a=yield e(null,null,function*(){return yield t.post("/api/quartz/SendTestNotification")});a.success?(s.success("æµ‹è¯•é€šçŸ¥å‘é€æˆåŠŸ"),Me()):s.error(a.message||"æµ‹è¯•é€šçŸ¥å‘é€å¤±è´¥")}catch(a){s.error("æµ‹è¯•é€šçŸ¥å‘é€å¤±è´¥")}finally{ge.value=!1}}),Le=e=>{be.value=e,je.value=!0},$e=a=>{l.confirm({title:"ç¡®è®¤åˆ é™¤",content:"ç¡®å®šè¦åˆ é™¤è¿™æ¡é€šçŸ¥å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚",okText:"ç¡®å®š",okType:"danger",cancelText:"å–æ¶ˆ",onOk(){return e(this,null,function*(){try{const i=yield(l=a.notificationId,e(null,null,function*(){return yield t.delete("/api/quartz/DeleteNotification",{params:{notificationId:l}})}));i.success?(s.success("é€šçŸ¥åˆ é™¤æˆåŠŸ"),Me()):s.error(i.message||"é€šçŸ¥åˆ é™¤å¤±è´¥")}catch(i){s.error("é€šçŸ¥åˆ é™¤å¤±è´¥")}var l})}})},De=()=>{l.confirm({title:"ç¡®è®¤æ¸…ç©º",content:"ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„é€šçŸ¥å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚",okText:"ç¡®å®š",okType:"danger",cancelText:"å–æ¶ˆ",onOk(){return e(this,null,function*(){try{const l=yield(a={pageIndex:1,pageSize:1,status:Te.value.status,triggeredBy:Te.value.triggeredBy},e(null,null,function*(){return yield t.post("/api/quartz/ClearNotifications",a)}));l.success?(s.success("é€šçŸ¥æ¸…ç©ºæˆåŠŸ"),Me()):s.error(l.message||"é€šçŸ¥æ¸…ç©ºå¤±è´¥")}catch(l){s.error("é€šçŸ¥æ¸…ç©ºå¤±è´¥")}var a})}})};return T(()=>{Me()}),(e,t)=>{const s=w("Alert");return I(),C(P(x),{"auto-content-height":""},{default:S(()=>[z(P(u),{class:"mb-4"},{default:S(()=>[z(P(m),{ref_key:"searchFormRef",ref:Oe,model:Te.value,layout:"horizontal","label-align":"right"},{default:S(()=>[z(P(c),{gutter:16},{default:S(()=>[z(P(p),{xs:24,sm:12,md:12,lg:8,xl:6,xxl:4},{default:S(()=>[z(P(m).Item,{label:"é€šçŸ¥çŠ¶æ€",name:"status"},{default:S(()=>[z(P(v),{value:Te.value.status,"onUpdate:value":t[0]||(t[0]=e=>Te.value.status=e),placeholder:"è¯·é€‰æ‹©çŠ¶æ€",allowClear:""},{default:S(()=>[z(P(v).Option,{value:P(J).Pending},{default:S(()=>[...t[15]||(t[15]=[U("å¾…å‘é€",-1)])]),_:1},8,["value"]),z(P(v).Option,{value:P(J).Sent},{default:S(()=>[...t[16]||(t[16]=[U("å‘é€æˆåŠŸ",-1)])]),_:1},8,["value"]),z(P(v).Option,{value:P(J).Failed},{default:S(()=>[...t[17]||(t[17]=[U("å‘é€å¤±è´¥",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1})]),_:1}),z(P(p),{xs:24,sm:12,md:12,lg:8,xl:6,xxl:6},{default:S(()=>[z(P(m).Item,{label:"è§¦å‘æ¥æº",name:"triggeredBy"},{default:S(()=>[z(P(f),{value:Te.value.triggeredBy,"onUpdate:value":t[1]||(t[1]=e=>Te.value.triggeredBy=e),placeholder:"è¯·è¾“å…¥è§¦å‘æ¥æº"},null,8,["value"])]),_:1})]),_:1}),z(P(p),{xs:24,sm:24,md:24,lg:8,xl:12,xxl:14,class:"text-right"},{default:S(()=>[z(P(g),null,{default:S(()=>[z(P(a),{type:"primary",onClick:Re},{default:S(()=>[...t[18]||(t[18]=[U("æœç´¢",-1)])]),_:1}),z(P(a),{onClick:qe},{default:S(()=>[...t[19]||(t[19]=[U("é‡ç½®",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),z(P(u),null,{default:S(()=>[B("div",E,[z(P(g),null,{default:S(()=>[z(P(a),{type:"primary",onClick:Je},{default:S(()=>[...t[20]||(t[20]=[U("é€šçŸ¥é…ç½®",-1)])]),_:1}),z(P(a),{type:"default",onClick:Ge},{default:S(()=>[...t[21]||(t[21]=[U("å‘é€æµ‹è¯•é€šçŸ¥",-1)])]),_:1})]),_:1}),z(P(g),null,{default:S(()=>[z(P(a),{danger:"",onClick:De},{default:S(()=>[...t[22]||(t[22]=[U("æ¸…ç©º",-1)])]),_:1})]),_:1})]),z(P(d),{columns:Ue.value,"data-source":ye.value,pagination:Be.value,loading:ge.value,rowKey:e=>e.notificationId,onChange:Fe,size:"middle",scroll:{x:"max-content"}},null,8,["columns","data-source","pagination","loading","rowKey"])]),_:1}),z(P(l),{open:Ie.value,"onUpdate:open":t[11]||(t[11]=e=>Ie.value=e),title:Se.value,width:"680px",destroyOnClose:"",onCancel:t[12]||(t[12]=e=>Ie.value=!1),centered:""},{footer:S(()=>[B("div",W,[z(P(a),{onClick:t[10]||(t[10]=e=>Ie.value=!1)},{default:S(()=>[...t[38]||(t[38]=[U("å–æ¶ˆ",-1)])]),_:1}),z(P(a),{type:"primary",loading:e.saveLoading,onClick:Ee},{default:S(()=>[...t[39]||(t[39]=[U("ä¿å­˜é…ç½®",-1)])]),_:1},8,["loading"])])]),default:S(()=>[B("div",G,[z(s,{message:"é…ç½® PushPlus é€šçŸ¥",description:"é€šè¿‡ PushPlus å®žæ—¶æŽ¥æ”¶ä½œä¸šæ‰§è¡Œæƒ…å†µï¼Œæ”¯æŒå¾®ä¿¡ã€é’‰é’‰ç­‰å¤šç§æ¸ é“ã€‚",type:"info","show-icon":"",class:"mb-6"}),z(P(m),{ref_key:"formRef",ref:Pe,model:ze,layout:"vertical",class:"custom-form"},{default:S(()=>[B("section",L,[B("div",$,[t[24]||(t[24]=B("span",{class:"icon"},"âš™ï¸",-1)),t[25]||(t[25]=B("span",{class:"title"},"åŸºç¡€é…ç½®",-1)),B("div",D,[t[23]||(t[23]=B("span",{class:"label"},"æœåŠ¡å¯ç”¨çŠ¶æ€",-1)),z(P(q),{checked:ze.enable,"onUpdate:checked":t[2]||(t[2]=e=>ze.enable=e),size:"small"},null,8,["checked"])])]),z(P(c),{gutter:24},{default:S(()=>[z(P(p),{span:24},{default:S(()=>[z(P(m).Item,{label:"PushPlus Token",name:"token",rules:[{required:ze.enable,message:"è¯·è¾“å…¥ Token"}]},{default:S(()=>[z(P(f),{value:ze.token,"onUpdate:value":t[3]||(t[3]=e=>ze.token=e),placeholder:"ä»Ž pushplus.plus èŽ·å–çš„ Token"},null,8,["value"])]),_:1},8,["rules"])]),_:1}),z(P(p),{span:12},{default:S(()=>[z(P(m).Item,{label:"æŽ¨é€æ¸ é“",name:"channel"},{default:S(()=>[z(P(v),{value:ze.channel,"onUpdate:value":t[4]||(t[4]=e=>ze.channel=e)},{default:S(()=>[z(P(v).Option,{value:"wechat"},{default:S(()=>[...t[26]||(t[26]=[U("å¾®ä¿¡å…¬ä¼—å·",-1)])]),_:1}),z(P(v).Option,{value:"cp"},{default:S(()=>[...t[27]||(t[27]=[U("ä¼ä¸šå¾®ä¿¡",-1)])]),_:1}),z(P(v).Option,{value:"webhook"},{default:S(()=>[...t[28]||(t[28]=[U("é’‰é’‰æœºå™¨äºº",-1)])]),_:1}),z(P(v).Option,{value:"mail"},{default:S(()=>[...t[29]||(t[29]=[U("ç”µå­é‚®ä»¶",-1)])]),_:1}),z(P(v).Option,{value:"sms"},{default:S(()=>[...t[30]||(t[30]=[U("æ‰‹æœºçŸ­ä¿¡",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),z(P(p),{span:12},{default:S(()=>[z(P(m).Item,{label:"æ¶ˆæ¯æ¨¡æ¿",name:"template"},{default:S(()=>[z(P(v),{value:ze.template,"onUpdate:value":t[5]||(t[5]=e=>ze.template=e)},{default:S(()=>[z(P(v).Option,{value:"html"},{default:S(()=>[...t[31]||(t[31]=[U("HTML (å¯Œæ–‡æœ¬)",-1)])]),_:1}),z(P(v).Option,{value:"text"},{default:S(()=>[...t[32]||(t[32]=[U("TEXT (çº¯æ–‡æœ¬)",-1)])]),_:1}),z(P(v).Option,{value:"markdown"},{default:S(()=>[...t[33]||(t[33]=[U("Markdown",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),z(P(p),{span:24},{default:S(()=>[z(P(m).Item,{label:"ä¸šåŠ¡ä¸»é¢˜ (Topic)",name:"topic"},{default:S(()=>[z(P(f),{value:ze.topic,"onUpdate:value":t[6]||(t[6]=e=>ze.topic=e),placeholder:"ç¾¤ç»„ç¼–ç ï¼Œä¸å¡«åˆ™å‘é€è‡³ä¸ªäºº"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),B("section",N,[t[37]||(t[37]=B("div",{class:"section-header"},[B("span",{class:"icon"},"ðŸ””"),B("span",{class:"title"},"é€šçŸ¥ç­–ç•¥")],-1)),B("div",H,[B("div",Q,[t[34]||(t[34]=B("div",{class:"strategy-info"},[B("div",{class:"name"},"ä½œä¸šæ‰§è¡ŒæˆåŠŸ"),B("div",{class:"desc"},"ä»»åŠ¡é¡ºåˆ©å®Œæˆæ—¶å‘é€é€šçŸ¥")],-1)),z(P(q),{checked:ze.strategy.notifyOnJobSuccess,"onUpdate:checked":t[7]||(t[7]=e=>ze.strategy.notifyOnJobSuccess=e)},null,8,["checked"])]),B("div",A,[t[35]||(t[35]=B("div",{class:"strategy-info"},[B("div",{class:"name"},"ä½œä¸šæ‰§è¡Œå¤±è´¥"),B("div",{class:"desc"},"ä»»åŠ¡æŠ¥é”™æˆ–å¼‚å¸¸ä¸­æ–­æ—¶å‘é€")],-1)),z(P(q),{checked:ze.strategy.notifyOnJobFailure,"onUpdate:checked":t[8]||(t[8]=e=>ze.strategy.notifyOnJobFailure=e)},null,8,["checked"])]),B("div",K,[t[36]||(t[36]=B("div",{class:"strategy-info"},[B("div",{class:"name"},"è°ƒåº¦å™¨ç³»ç»Ÿå¼‚å¸¸"),B("div",{class:"desc"},"Quartz æ ¸å¿ƒæœåŠ¡å‡ºçŽ°æ•…éšœæ—¶")],-1)),z(P(q),{checked:ze.strategy.notifyOnSchedulerError,"onUpdate:checked":t[9]||(t[9]=e=>ze.strategy.notifyOnSchedulerError=e)},null,8,["checked"])])])])]),_:1},8,["model"])])]),_:1},8,["open","title"]),z(P(l),{open:je.value,"onUpdate:open":t[14]||(t[14]=e=>je.value=e),title:ke.value,width:"80%","max-width":1200,footer:null,destroyOnClose:!0},{default:S(()=>[be.value?(I(),F("div",X,[B("div",V,[B("div",Y,[z(P(y).Title,{level:4,class:"m-0 text-ellipsis max-w-[70%]"},{default:S(()=>[U(R(be.value.title),1)]),_:1}),z(P(n),{color:h[be.value.status].status,class:"text-lg px-4 py-1 text-base"},{default:S(()=>[U(R(h[be.value.status].text),1)]),_:1},8,["color"])]),B("div",Z,[B("div",ee,[t[40]||(t[40]=B("span",{class:"font-semibold text-sm opacity-80"},"è§¦å‘æ¥æº:",-1)),B("span",te,R(be.value.triggeredBy||"-"),1)]),B("div",ae,[t[41]||(t[41]=B("span",{class:"font-semibold text-sm opacity-80"},"å‘é€æ—¶é—´:",-1)),B("span",le,R(be.value.sendTime?P(O)(be.value.sendTime):"-"),1)]),B("div",se,[t[42]||(t[42]=B("span",{class:"font-semibold text-sm opacity-80"},"å‘é€è€—æ—¶:",-1)),B("span",ie,R(be.value.duration?`${be.value.duration} ms`:"0 ms"),1)]),B("div",ne,[t[43]||(t[43]=B("span",{class:"font-semibold text-sm opacity-80"},"åˆ›å»ºæ—¶é—´:",-1)),B("span",oe,R(P(O)(be.value.createTime)),1)])])]),B("div",re,[B("div",de,[z(P(y).Title,{level:5,class:"mb-3"},{default:S(()=>[...t[44]||(t[44]=[U("é€šçŸ¥å†…å®¹",-1)])]),_:1}),B("div",ue,[B("div",{class:"word-break-break-word text-sm",innerHTML:be.value.content},null,8,ce)])]),be.value.errorMessage?(I(),F("div",pe,[z(P(y).Title,{level:5,class:"mb-3"},{default:S(()=>[...t[45]||(t[45]=[U("é”™è¯¯ä¿¡æ¯",-1)])]),_:1}),B("div",me,[B("pre",ve,R(be.value.errorMessage),1)])])):M("",!0)])])):M("",!0),B("div",fe,[z(P(a),{onClick:t[13]||(t[13]=e=>je.value=!1),type:"primary",size:"large",class:"px-6"},{default:S(()=>[...t[46]||(t[46]=[U(" å…³é—­ ",-1)])]),_:1})])]),_:1},8,["open","title"])]),_:1})}}}),[["__scopeId","data-v-fa90042d"]]);export{ge as default};

var se=Object.defineProperty,le=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var M=(o,m,n)=>m in o?se(o,m,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[m]=n,E=(o,m)=>{for(var n in m||(m={}))re.call(m,n)&&M(o,n,m[n]);if(B)for(var n of B(m))ie.call(m,n)&&M(o,n,m[n]);return o},P=(o,m)=>le(o,oe(m));var w=(o,m,n)=>new Promise((b,f)=>{var _=u=>{try{g(n.next(u))}catch(y){f(y)}},j=u=>{try{g(n.throw(u))}catch(y){f(y)}},g=u=>u.done?b(u.value):Promise.resolve(u.value).then(_,j);g((n=n.apply(o,m)).next())});import{bX as Q,a1 as C,c1 as V,ci as k}from"./bootstrap-BMeNQAZx.js";import{T as A}from"./index-POob_1RE.js";import{C as J}from"./index-BJS2IHii.js";import{F as N}from"./index-CZEOE6Qp.js";import q from"./index-fs2zjLt1.js";import D from"./index-CMoHiTEd.js";import{D as L}from"./dayjs-DPH2qeQP.js";import F from"./index-DIvvDFJy.js";import{T as de}from"./index-CRDp__WI.js";import{T as O}from"./index-PfXXGD_h.js";import{_ as ne}from"./page.vue_vue_type_script_setup_true_lang-CS7UYXux.js";import{a1 as ue,L as v,P as me,E as K,f as pe,bG as $,ai as ve,aj as R,ak as l,p as s,a9 as t,as as U,an as G,aw as p,F as ce,ax as c,aU as i}from"../jse/index-index-DDhSeprS.js";import{R as fe,C as S}from"./index-B5ZMWZyh.js";import"./colors-C17r0r-F.js";import"./index-ZLERSN-m.js";import"./shallowequal-BysuHILK.js";import"./Trigger-DU77Nilf.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-B4vrbBUF.js";import"./index-C0IbcXwf.js";import"./index-CYt74yuO.js";import"./collapseMotion-Dorb0iJe.js";import"./slide-BCVjwQiU.js";import"./useRefs-BOrpujgz.js";import"./responsiveObserve-BNTUI5kZ.js";import"./isMobile-8sZ0LT6r.js";import"./useMergedState-BQ_DQ3oe.js";import"./isPlainObject-DPODxdHC.js";import"./Col-fqZi5xni.js";import"./useFlexGapSupport-DEWLEXas.js";import"./debounce-DcTDLchz.js";import"./FormItemContext-BMHY2c9w.js";import"./statusUtils-HbSVYBr5.js";import"./BaseInput-Cjnf0cGc.js";import"./index-BQnMTEYE.js";import"./SearchOutlined-CqWOrK5u.js";import"./EyeOutlined-D-p8gDvh.js";import"./index-Da0xU_xl.js";import"./DownOutlined-CDMyN1UG.js";import"./CheckOutlined-DVxf_bZR.js";import"./move-CGB3tLTC.js";import"./index-CID9gU7c.js";import"./index-D-4N7I1a.js";import"./index-B76EbQhK.js";import"./index-CXncSQSj.js";import"./index-LmdZbfao.js";import"./Checkbox-C1tcaaAE.js";import"./index-S2zvttTN.js";var T=(o=>(o[o.SUCCESS=1]="SUCCESS",o[o.ERROR=0]="ERROR",o[o.RUNNING=2]="RUNNING",o))(T||{});function ge(o){return w(this,null,function*(){return Q.post("/api/quartz/GetJobLogs",o)})}function be(){return w(this,arguments,function*(o={}){return yield Q.post("/api/quartz/ClearLogs",o)})}const ye={class:"mb-4 flex items-center justify-end"},xe={key:0,class:"log-detail"},_e={class:"detail-header mb-4 rounded-lg bg-gray-50 p-4"},we={class:"mb-3 flex items-center justify-between"},Te={class:"mt-2 grid grid-cols-1 gap-4 md:grid-cols-3"},Ce={class:"flex items-center"},ke={class:"flex items-center"},Ne={class:"flex items-center"},Re={class:"detail-content"},Se={class:"mb-6"},je={class:"rounded-lg border border-gray-200 bg-gray-50 p-4"},Ie={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm"},he={key:0,class:"mb-6"},Oe={class:"rounded-lg border border-red-200 bg-red-50 p-4"},Ue={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm text-red-800"},Ge={key:1,class:"mb-6"},ze={class:"rounded-lg border border-blue-200 bg-blue-50 p-4"},De={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm"},$e={key:2,class:"mb-6"},Fe={class:"rounded-lg border border-green-200 bg-green-50 p-4"},Be={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm"},Me={class:"mt-4 flex justify-end"},Bt=ue({__name:"log",setup(o){const m={[T.SUCCESS]:{text:"成功",status:"success"},[T.ERROR]:{text:"失败",status:"error"},[T.RUNNING]:{text:"运行中",status:"processing"}},n=v(!1),b=v([]),f=v(0),_=v(1),j=v(10),g=v(),u=me({jobName:"",jobGroup:"",status:void 0,startTime:void 0,endTime:void 0}),y=v(!1),z=v(!1),X=v("日志详情"),r=v(null),I=v(""),x=v(""),H=K(()=>[{title:"作业名称",dataIndex:"jobName",ellipsis:!0,fixed:"left",width:300},{title:"作业分组",dataIndex:"jobGroup",ellipsis:!0,fixed:"left",width:300},{title:"状态",dataIndex:"status",customRender:({record:a})=>{const e=m[a.status];return pe(A,{color:e.status},e.text)}},{title:"开始时间",dataIndex:"startTime",ellipsis:!0,sorter:!0,sortOrder:I.value==="startTime"?x.value==="asc"?"ascend":x.value==="desc"?"descend":void 0:void 0,customRender:({record:a})=>a.startTime?$(a.startTime):"-"},{title:"结束时间",dataIndex:"endTime",ellipsis:!0,sorter:!0,sortOrder:I.value==="endTime"?x.value==="asc"?"ascend":x.value==="desc"?"descend":void 0:void 0,customRender:({record:a})=>a.endTime?$(a.endTime):"-"},{title:"执行时长(ms)",dataIndex:"duration",ellipsis:!0,sorter:!0,sortOrder:I.value==="duration"?x.value==="asc"?"ascend":x.value==="desc"?"descend":void 0:void 0},{title:"操作",width:80,key:"action",slots:{customRender:"action"}}]),W=K(()=>({current:_.value,pageSize:j.value,total:f.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(a,e)=>`${e[0]}-${e[1]} 共 ${a} 条`,pageSizeOptions:["10","20","50","100"]})),h=()=>w(null,null,function*(){n.value=!0;try{const a=yield ge(P(E({},u),{pageIndex:_.value||1,pageSize:j.value||10,sortBy:I.value,sortOrder:x.value}));if(console.log("API响应:",a),a.success)a.data&&a.data.items&&Array.isArray(a.data.items)?(b.value=a.data.items,f.value=a.data.totalCount||0,console.log(`成功加载日志列表: ${b.value.length} 条记录，共 ${f.value} 条，总页数：${a.data.totalPages}`)):(console.warn("API响应数据格式不符合预期",a.data),b.value=[],f.value=0);else{const e=a.errorCode?`${a.message||"获取日志列表失败"} (错误码: ${a.errorCode})`:a.message||"获取日志列表失败";k.error(e),b.value=[],f.value=0}}catch(a){console.log("获取日志列表时发生错误:",a),k.error(typeof a=="object"&&a!==null&&"message"in a?String(a.message):"获取日志列表失败"),b.value=[],f.value=0}finally{n.value=!1}}),Y=(a,e,d)=>{a.current!==void 0&&(_.value=a.current),a.pageSize!==void 0&&(j.value=a.pageSize),d.field!==void 0&&(I.value=d.field,x.value=d.order==="ascend"?"asc":d.order==="descend"?"desc":""),h()},Z=()=>w(null,null,function*(){g.value&&(yield g.value.validateFields()),_.value=1,h()}),ee=()=>{g.value&&g.value.resetFields(),_.value=1,h()},te=()=>{V.confirm({title:"确认清空",content:"确定要清空日志吗？此操作不可恢复！",onOk:()=>w(null,null,function*(){try{const a=yield be({jobName:"",jobGroup:"",status:void 0,startTime:void 0,endTime:void 0});a.success?(k.success("日志清空成功"),yield h()):k.error(a.message||"日志清空失败")}catch(a){console.error("清空日志失败:",a),k.error(a.message||"日志清空失败")}})})},ae=a=>{try{r.value=a,z.value=!0}catch(e){k.error("显示详情失败"),console.log("显示详情失败:",e)}};return w(null,null,function*(){yield h()}),(a,e)=>(R(),ve(t(ne),null,{default:l(()=>[s(t(J),{class:"mb-4"},{default:l(()=>[s(t(N),{ref_key:"searchFormRef",ref:g,model:u,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18},"label-align":"right"},{default:l(()=>[s(t(fe),{gutter:16},{default:l(()=>[s(t(S),{xs:24,sm:12,md:8,lg:8},{default:l(()=>[s(t(N).Item,{label:"作业名称",name:"jobName"},{default:l(()=>[s(t(q),{value:u.jobName,"onUpdate:value":e[0]||(e[0]=d=>u.jobName=d),placeholder:"请输入作业名称"},null,8,["value"])]),_:1})]),_:1}),s(t(S),{xs:24,sm:12,md:8,lg:8},{default:l(()=>[s(t(N).Item,{label:"作业分组",name:"jobGroup"},{default:l(()=>[s(t(q),{value:u.jobGroup,"onUpdate:value":e[1]||(e[1]=d=>u.jobGroup=d),placeholder:"请输入作业分组"},null,8,["value"])]),_:1})]),_:1}),s(t(S),{xs:24,sm:12,md:8,lg:8},{default:l(()=>[s(t(N).Item,{label:"执行状态",name:"status"},{default:l(()=>[s(t(D),{value:u.status,"onUpdate:value":e[2]||(e[2]=d=>u.status=d),placeholder:"请选择状态",allowClear:""},{default:l(()=>[s(t(D).Option,{value:t(T).SUCCESS},{default:l(()=>[...e[8]||(e[8]=[p("成功",-1)])]),_:1},8,["value"]),s(t(D).Option,{value:t(T).ERROR},{default:l(()=>[...e[9]||(e[9]=[p("失败",-1)])]),_:1},8,["value"]),s(t(D).Option,{value:t(T).RUNNING},{default:l(()=>[...e[10]||(e[10]=[p("运行中",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1})]),_:1}),y.value?(R(),U(ce,{key:0},[s(t(S),{xs:24,sm:12,md:8,lg:8},{default:l(()=>[s(t(N).Item,{label:"开始时间",name:"startTime"},{default:l(()=>[s(t(L),{value:u.startTime,"onUpdate:value":e[3]||(e[3]=d=>u.startTime=d),showTime:"",placeholder:"选择开始时间"},null,8,["value"])]),_:1})]),_:1}),s(t(S),{xs:24,sm:12,md:8,lg:8},{default:l(()=>[s(t(N).Item,{label:"结束时间",name:"endTime"},{default:l(()=>[s(t(L),{value:u.endTime,"onUpdate:value":e[4]||(e[4]=d=>u.endTime=d),showTime:"",placeholder:"选择结束时间"},null,8,["value"])]),_:1})]),_:1})],64)):G("",!0),s(t(S),{xs:24,sm:24,md:24,lg:24,class:"text-right"},{default:l(()=>[s(t(F),null,{default:l(()=>[s(t(C),{type:"primary",onClick:Z},{default:l(()=>[...e[11]||(e[11]=[p(" 搜索 ",-1)])]),_:1}),s(t(C),{onClick:ee},{default:l(()=>[...e[12]||(e[12]=[p(" 重置 ",-1)])]),_:1}),s(t(C),{type:"link",onClick:e[5]||(e[5]=d=>y.value=!y.value)},{default:l(()=>[p(c(y.value?"收起":"展开"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),s(t(J),null,{default:l(()=>[i("div",ye,[s(t(F),null,{default:l(()=>[s(t(C),{danger:"",onClick:te},{default:l(()=>[...e[13]||(e[13]=[p("清空日志",-1)])]),_:1})]),_:1})]),s(t(de),{columns:H.value,"data-source":b.value,pagination:W.value,loading:n.value,rowKey:d=>d.logId,size:"middle",onChange:Y,scroll:{x:"max-content"},")":""},{action:l(({record:d})=>[s(t(F),{size:"middle"},{default:l(()=>[s(t(C),{type:"primary",onClick:Pe=>ae(d),disabled:n.value},{default:l(()=>[...e[14]||(e[14]=[p(" 详情 ",-1)])]),_:1},8,["onClick","disabled"])]),_:2},1024)]),default:l(()=>[e[15]||(e[15]=p('}"> ',-1))]),_:1},8,["columns","data-source","pagination","loading","rowKey"])]),_:1}),s(t(V),{open:z.value,"onUpdate:open":e[7]||(e[7]=d=>z.value=d),title:X.value,width:"1000px",footer:null,destroyOnClose:!0},{default:l(()=>[r.value?(R(),U("div",xe,[i("div",_e,[i("div",we,[s(t(O).Title,{level:4,class:"m-0"},{default:l(()=>[p(c(r.value.jobName)+" - "+c(r.value.jobGroup),1)]),_:1}),s(t(A),{color:m[r.value.status].status,class:"text-lg"},{default:l(()=>[p(c(m[r.value.status].text),1)]),_:1},8,["color"])]),i("div",Te,[i("div",Ce,[e[16]||(e[16]=i("span",{class:"mr-2 font-bold"},"执行时长:",-1)),i("span",null,c(r.value.duration||0)+" ms",1)]),i("div",ke,[e[17]||(e[17]=i("span",{class:"mr-2 font-bold"},"开始时间:",-1)),i("span",null,c(t($)(r.value.startTime)),1)]),i("div",Ne,[e[18]||(e[18]=i("span",{class:"mr-2 font-bold"},"结束时间:",-1)),i("span",null,c(r.value.endTime?t($)(r.value.endTime):"-"),1)])])]),i("div",Re,[i("div",Se,[s(t(O).Title,{level:5,class:"mb-2"},{default:l(()=>[...e[19]||(e[19]=[p("执行信息",-1)])]),_:1}),i("div",je,[i("pre",Ie,"                "+c(r.value.executionInfo||r.value.message||"暂无执行信息")+`
              `,1)])]),r.value.errorMessage||r.value.exception?(R(),U("div",he,[s(t(O).Title,{level:5,class:"mb-2"},{default:l(()=>[...e[20]||(e[20]=[p("错误信息",-1)])]),_:1}),i("div",Oe,[i("pre",Ue,"                "+c(r.value.errorMessage||r.value.exception)+`
              `,1)])])):G("",!0),r.value.result?(R(),U("div",Ge,[s(t(O).Title,{level:5,class:"mb-2"},{default:l(()=>[...e[21]||(e[21]=[p("执行结果",-1)])]),_:1}),i("div",ze,[i("pre",De,"                "+c(typeof r.value.result=="string"?r.value.result:JSON.stringify(r.value.result,null,2))+`
              `,1)])])):G("",!0),r.value.jobData?(R(),U("div",$e,[s(t(O).Title,{level:5,class:"mb-2"},{default:l(()=>[...e[22]||(e[22]=[p("作业数据",-1)])]),_:1}),i("div",Fe,[i("pre",Be,"                "+c(typeof r.value.jobData=="string"?r.value.jobData:JSON.stringify(r.value.jobData,null,2))+`
              `,1)])])):G("",!0)])])):G("",!0),i("div",Me,[s(t(C),{onClick:e[6]||(e[6]=d=>z.value=!1),type:"primary"},{default:l(()=>[...e[23]||(e[23]=[p("关闭",-1)])]),_:1})])]),_:1},8,["open","title"])]),_:1}))}});export{Bt as default};

var p=(i,b,v)=>new Promise((N,M)=>{var O=k=>{try{T(v.next(k))}catch(d){M(d)}},B=k=>{try{T(v.throw(k))}catch(d){M(d)}},T=k=>k.done?N(k.value):Promise.resolve(k.value).then(O,B);T((v=v.apply(i,b)).next())});import{bX as h,a1 as x,c1 as U,ci as f,bG as me}from"./bootstrap-lEmF9XJu.js";import{T as H}from"./index-BNW25RbA.js";import{M as D}from"./index-C1xcQljw.js";import{D as pe,T as fe}from"./index-CMZq00fX.js";import{C as E}from"./index-CEgAB7yt.js";import{F as g}from"./index-wlGTmOE9.js";import c from"./index-DMP4-38E.js";import V from"./index-BHouI75T.js";import j from"./index-DTmTvwrF.js";import{T as L}from"./index-DE-0LEdn.js";import{_ as ce}from"./page.vue_vue_type_script_setup_true_lang-BBjywRTl.js";import{a1 as ve,L as m,P as ge,E as K,f as P,bG as R,aa as ye,ai as be,aj as G,ak as l,p as a,a9 as t,aw as r,aU as n,as as X,an as Q,ax as _}from"../jse/index-index-BsF0brD9.js";import{R as A,C as w}from"./index-CvR3TzMo.js";import J from"./index-CAC3-M77.js";import"./colors-DyVIRDXd.js";import"./shallowequal-h_MEvtB1.js";import"./Trigger-Uk82o0xq.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-C3cvqQB6.js";import"./index-BEjNv8kv.js";import"./index-CczUa9x9.js";import"./collapseMotion-C2mNgCUI.js";import"./slide-BtIb5zMy.js";import"./index-CKAJYxHW.js";import"./index-BDjSGim2.js";import"./BaseInput-DMTBeoq7.js";import"./isMobile-8sZ0LT6r.js";import"./DownOutlined-BWI0ODNq.js";import"./CheckOutlined-OmcL68mK.js";import"./SearchOutlined-BSvfWRmg.js";import"./move-CHIG4wU9.js";import"./index-Bb-Llysu.js";import"./index-DsY2MFbQ.js";import"./responsiveObserve-BeXGRYk6.js";import"./index-Dc4PwqN7.js";import"./useMergedState-KNEdJhwo.js";import"./index-DQxGSONR.js";import"./Checkbox-DDUxcg7n.js";import"./FormItemContext-BVfyPez8.js";import"./index-C39TteCa.js";import"./debounce-CczikTky.js";import"./useRefs-Ds8aQx_s.js";import"./isPlainObject-E6RKNC7r.js";import"./Col-BVHrw1cg.js";import"./useFlexGapSupport-BJcXEFrC.js";import"./statusUtils-C2A6JYdH.js";import"./EyeOutlined-C00y1R2-.js";var I=(i=>(i[i.Pending=0]="Pending",i[i.Sent=1]="Sent",i[i.Failed=2]="Failed",i))(I||{});const ke=()=>p(null,null,function*(){return yield h.get("/api/quartz/GetPushPlusConfig")}),xe=i=>p(null,null,function*(){return yield h.post("/api/quartz/SavePushPlusConfig",i)}),we=()=>p(null,null,function*(){return yield h.post("/api/quartz/SendTestNotification")}),Te=i=>p(null,null,function*(){return yield h.post("/api/quartz/GetNotifications",i)}),Oe=i=>p(null,null,function*(){return yield h.delete("/api/quartz/DeleteNotification",{params:{notificationId:i}})}),Ce=i=>p(null,null,function*(){return yield h.post("/api/quartz/ClearNotifications",i)}),_e={class:"mb-4 flex items-center justify-between"},Ie={key:0,class:"notification-detail"},Se={class:"detail-header mb-4 rounded-lg bg-gray-50 p-4"},Pe={class:"mb-3 flex items-center justify-between"},he={class:"mt-2 grid grid-cols-1 gap-4 md:grid-cols-4"},Me={class:"flex items-center"},Be={class:"flex items-center"},ze={class:"flex items-center"},Fe={class:"flex items-center"},Ne={class:"detail-content"},Ue={class:"mb-6"},Re={class:"content-box rounded-lg border border-gray-200 bg-gray-50 p-4"},Je=["innerHTML"],qe={key:0,class:"mb-6"},$e={class:"rounded-lg border border-red-200 bg-red-50 p-4"},De={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm text-red-800"},Ve={class:"mt-4 flex justify-end"},je=ve({__name:"notification",setup(i){const b={[I.Pending]:{text:"待发送",status:"default"},[I.Sent]:{text:"发送成功",status:"success"},[I.Failed]:{text:"发送失败",status:"error"}},v=m(!1),N=m([]),M=m(0),O=m(1),B=m(10),T=m(!1),k=m("通知详情"),d=m(null),q=m(),y=m({status:void 0,triggeredBy:""}),z=m(""),F=m(void 0),S=m(!1),W=m("通知配置"),u=ge({token:"",channel:"wechat",template:"html",topic:"",enable:!1,strategy:{notifyOnJobSuccess:!1,notifyOnJobFailure:!0,notifyOnSchedulerError:!0}}),$=m(),Y=K(()=>[{title:"通知标题",dataIndex:"title",ellipsis:!0},{title:"触发来源",dataIndex:"triggeredBy",ellipsis:!0},{title:"状态",dataIndex:"status",ellipsis:!0,customRender:({record:o})=>{const e=b[o.status];return{children:P(H,{color:(e==null?void 0:e.status)||"default"},(e==null?void 0:e.text)||o.status||"未知")}}},{title:"发送时间",dataIndex:"sendTime",ellipsis:!0,sorter:!0,sortOrder:z.value==="sendTime"?F.value:void 0,customRender:({record:o})=>({children:o.sendTime?R(o.sendTime):"-"})},{title:"耗时(ms)",dataIndex:"duration",ellipsis:!0,sorter:!0,sortOrder:z.value==="duration"?F.value:void 0},{title:"创建时间",dataIndex:"createTime",ellipsis:!0,sorter:!0,sortOrder:z.value==="createTime"?F.value:void 0,customRender:({record:o})=>({children:o.createTime?R(o.createTime):"-"})},{title:"操作",key:"action",width:80,customRender:({record:o})=>{const e=P(D.Item,{onClick:()=>re(o)},"详情"),s=P(D.Item,{onClick:()=>ne(o),danger:!0},"删除"),ue=P(D,null,[e,s]),de=P(x,{type:"primary",disabled:v.value},"操作");return{children:P(pe,{trigger:["click"],overlay:ue},()=>de)}}}]),Z=K(()=>({current:O.value,pageSize:B.value,total:M.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(o,e)=>`${e[0]}-${e[1]} 共 ${o} 条`,pageSizeOptions:["10","20","50","100"]})),ee=(o,e,s)=>{o.current!==void 0&&(O.value=o.current),o.pageSize!==void 0&&(B.value=o.pageSize),s.field!==void 0&&(z.value=s.field,F.value=s.order==="ascend"?"ascend":s.order==="descend"?"descend":void 0),C()},C=()=>p(null,null,function*(){var o,e;v.value=!0;try{const s=yield Te({pageIndex:O.value,pageSize:B.value,status:y.value.status,triggeredBy:y.value.triggeredBy,sortBy:z.value,sortOrder:F.value});N.value=((o=s.data)==null?void 0:o.items)||[],M.value=((e=s.data)==null?void 0:e.totalCount)||0}catch(s){f.error("获取通知列表失败"),console.error("获取通知列表失败:",s)}finally{v.value=!1}}),te=()=>p(null,null,function*(){q.value&&(yield q.value.validateFields()),O.value=1,C()}),ae=()=>{y.value={status:void 0,triggeredBy:""},O.value=1,C()},le=()=>p(null,null,function*(){try{const o=yield ke();Object.assign(u,o.data),S.value=!0}catch(o){f.error("获取配置失败"),console.error("获取配置失败:",o)}}),se=()=>p(null,null,function*(){if($.value)try{yield $.value.validateFields(),v.value=!0;const o=yield xe(u);o.success?(f.success("配置保存成功"),S.value=!1):f.error(o.message||"配置保存失败")}catch(o){if(o.errorFields)return;const e=o.message||"配置保存失败";f.error(e),console.error("保存配置失败:",o)}finally{v.value=!1}}),oe=()=>p(null,null,function*(){try{v.value=!0;const o=yield we();o.success?(f.success("测试通知发送成功"),C()):f.error(o.message||"测试通知发送失败")}catch(o){f.error("测试通知发送失败"),console.error("发送测试通知失败:",o)}finally{v.value=!1}}),re=o=>{d.value=o,T.value=!0},ne=o=>{U.confirm({title:"确认删除",content:"确定要删除这条通知吗？此操作不可恢复。",okText:"确定",okType:"danger",cancelText:"取消",onOk(){return p(this,null,function*(){try{const s=yield Oe(o.notificationId);s.success?(f.success("通知删除成功"),C()):f.error(s.message||"通知删除失败")}catch(s){f.error("通知删除失败"),console.error("删除通知失败:",s)}})}})},ie=()=>{U.confirm({title:"确认清空",content:"确定要清空所有符合条件的通知吗？此操作不可恢复。",okText:"确定",okType:"danger",cancelText:"取消",onOk(){return p(this,null,function*(){try{const e=yield Ce({pageIndex:1,pageSize:1,status:y.value.status,triggeredBy:y.value.triggeredBy});e.success?(f.success("通知清空成功"),C()):f.error(e.message||"通知清空失败")}catch(e){f.error("通知清空失败"),console.error("清空通知失败:",e)}})}})};return ye(()=>{C()}),(o,e)=>(G(),be(t(ce),null,{default:l(()=>[a(t(E),{class:"mb-4"},{default:l(()=>[a(t(g),{ref_key:"searchFormRef",ref:q,model:y.value,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18},"label-align":"right"},{default:l(()=>[a(t(A),{gutter:16},{default:l(()=>[a(t(w),{xs:24,sm:12,md:8,lg:8},{default:l(()=>[a(t(g).Item,{label:"通知状态",name:"status"},{default:l(()=>[a(t(c),{value:y.value.status,"onUpdate:value":e[0]||(e[0]=s=>y.value.status=s),placeholder:"请选择状态",allowClear:""},{default:l(()=>[a(t(c).Option,{value:t(I).Pending},{default:l(()=>[...e[15]||(e[15]=[r("待发送",-1)])]),_:1},8,["value"]),a(t(c).Option,{value:t(I).Sent},{default:l(()=>[...e[16]||(e[16]=[r("发送成功",-1)])]),_:1},8,["value"]),a(t(c).Option,{value:t(I).Failed},{default:l(()=>[...e[17]||(e[17]=[r("发送失败",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1})]),_:1}),a(t(w),{xs:24,sm:12,md:8,lg:8},{default:l(()=>[a(t(g).Item,{label:"触发来源",name:"triggeredBy"},{default:l(()=>[a(t(V),{value:y.value.triggeredBy,"onUpdate:value":e[1]||(e[1]=s=>y.value.triggeredBy=s),placeholder:"请输入触发来源"},null,8,["value"])]),_:1})]),_:1}),a(t(w),{xs:24,sm:24,md:24,lg:8,class:"text-right"},{default:l(()=>[a(t(j),null,{default:l(()=>[a(t(x),{type:"primary",onClick:te},{default:l(()=>[...e[18]||(e[18]=[r("搜索",-1)])]),_:1}),a(t(x),{onClick:ae},{default:l(()=>[...e[19]||(e[19]=[r("重置",-1)])]),_:1}),a(t(x),{danger:"",onClick:ie},{default:l(()=>[...e[20]||(e[20]=[r("清空",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(t(E),null,{default:l(()=>[n("div",_e,[a(t(j),null,{default:l(()=>[a(t(x),{type:"primary",onClick:le},{default:l(()=>[...e[21]||(e[21]=[r("通知配置",-1)])]),_:1}),a(t(x),{type:"default",onClick:oe},{default:l(()=>[...e[22]||(e[22]=[r("发送测试通知",-1)])]),_:1})]),_:1})]),a(t(fe),{columns:Y.value,"data-source":N.value,pagination:Z.value,loading:v.value,rowKey:s=>s.notificationId,onChange:ee,size:"middle",scroll:{x:"max-content"}},null,8,["columns","data-source","pagination","loading","rowKey"])]),_:1}),a(t(U),{visible:S.value,"onUpdate:visible":e[11]||(e[11]=s=>S.value=s),title:W.value,width:"800px","body-style":{padding:"24px"},destroyOnClose:"",onCancel:e[12]||(e[12]=s=>S.value=!1)},{footer:l(()=>[a(t(j),null,{default:l(()=>[a(t(x),{onClick:e[10]||(e[10]=s=>S.value=!1)},{default:l(()=>[...e[31]||(e[31]=[r("取消",-1)])]),_:1}),a(t(x),{type:"primary",onClick:se},{default:l(()=>[...e[32]||(e[32]=[r("保存",-1)])]),_:1})]),_:1})]),default:l(()=>[a(t(g),{ref_key:"formRef",ref:$,model:u,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18},"label-align":"right"},{default:l(()=>[a(t(A),{gutter:16},{default:l(()=>[a(t(w),{xs:24,sm:24,md:24},{default:l(()=>[a(t(g).Item,{label:"是否启用",name:"enable",valuePropName:"checked"},{default:l(()=>[a(t(J),{checked:u.enable,"onUpdate:checked":e[2]||(e[2]=s=>u.enable=s)},null,8,["checked"])]),_:1})]),_:1}),a(t(w),{xs:24,sm:24,md:24},{default:l(()=>[a(t(g).Item,{label:"Token",name:"token",rules:[{required:u.enable,message:"请输入PushPlus Token"}]},{default:l(()=>[a(t(V),{value:u.token,"onUpdate:value":e[3]||(e[3]=s=>u.token=s),placeholder:"请输入PushPlus Token"},null,8,["value"])]),_:1},8,["rules"])]),_:1}),a(t(w),{xs:24,sm:24,md:24},{default:l(()=>[a(t(g).Item,{label:"推送渠道",name:"channel"},{default:l(()=>[a(t(c),{value:u.channel,"onUpdate:value":e[4]||(e[4]=s=>u.channel=s)},{default:l(()=>[a(t(c).Option,{value:"wechat"},{default:l(()=>[...e[23]||(e[23]=[r("微信",-1)])]),_:1}),a(t(c).Option,{value:"cp"},{default:l(()=>[...e[24]||(e[24]=[r("企业微信",-1)])]),_:1}),a(t(c).Option,{value:"webhook"},{default:l(()=>[...e[25]||(e[25]=[r("钉钉",-1)])]),_:1}),a(t(c).Option,{value:"mail"},{default:l(()=>[...e[26]||(e[26]=[r("邮件",-1)])]),_:1}),a(t(c).Option,{value:"sms"},{default:l(()=>[...e[27]||(e[27]=[r("短信",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(t(w),{xs:24,sm:24,md:24},{default:l(()=>[a(t(g).Item,{label:"消息模板",name:"template"},{default:l(()=>[a(t(c),{value:u.template,"onUpdate:value":e[5]||(e[5]=s=>u.template=s)},{default:l(()=>[a(t(c).Option,{value:"html"},{default:l(()=>[...e[28]||(e[28]=[r("HTML",-1)])]),_:1}),a(t(c).Option,{value:"text"},{default:l(()=>[...e[29]||(e[29]=[r("TEXT",-1)])]),_:1}),a(t(c).Option,{value:"markdown"},{default:l(()=>[...e[30]||(e[30]=[r("Markdown",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(t(w),{xs:24,sm:24,md:24},{default:l(()=>[a(t(g).Item,{label:"主题",name:"topic"},{default:l(()=>[a(t(V),{value:u.topic,"onUpdate:value":e[6]||(e[6]=s=>u.topic=s),placeholder:"请输入主题（可选）"},null,8,["value"])]),_:1})]),_:1}),a(t(w),{xs:24,sm:24,md:24},{default:l(()=>[a(t(g).Item,{label:"通知策略",class:"mt-4"},{default:l(()=>[a(t(g).Item,{label:"作业成功时发送",name:"strategy.notifyOnJobSuccess",valuePropName:"checked"},{default:l(()=>[a(t(J),{checked:u.strategy.notifyOnJobSuccess,"onUpdate:checked":e[7]||(e[7]=s=>u.strategy.notifyOnJobSuccess=s)},null,8,["checked"])]),_:1}),a(t(g).Item,{label:"作业失败时发送",name:"strategy.notifyOnJobFailure",valuePropName:"checked"},{default:l(()=>[a(t(J),{checked:u.strategy.notifyOnJobFailure,"onUpdate:checked":e[8]||(e[8]=s=>u.strategy.notifyOnJobFailure=s)},null,8,["checked"])]),_:1}),a(t(g).Item,{label:"调度器异常时发送",name:"strategy.notifyOnSchedulerError",valuePropName:"checked"},{default:l(()=>[a(t(J),{checked:u.strategy.notifyOnSchedulerError,"onUpdate:checked":e[9]||(e[9]=s=>u.strategy.notifyOnSchedulerError=s)},null,8,["checked"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),a(t(U),{open:T.value,"onUpdate:open":e[14]||(e[14]=s=>T.value=s),title:k.value,width:"1000px",footer:null,destroyOnClose:!0},{default:l(()=>[d.value?(G(),X("div",Ie,[n("div",Se,[n("div",Pe,[a(t(L).Title,{level:4,class:"m-0"},{default:l(()=>[r(_(d.value.title),1)]),_:1}),a(t(H),{color:b[d.value.status].status,class:"text-lg"},{default:l(()=>[r(_(b[d.value.status].text),1)]),_:1},8,["color"])]),n("div",he,[n("div",Me,[e[33]||(e[33]=n("span",{class:"mr-2 font-bold"},"触发来源:",-1)),n("span",null,_(d.value.triggeredBy||"-"),1)]),n("div",Be,[e[34]||(e[34]=n("span",{class:"mr-2 font-bold"},"发送时间:",-1)),n("span",null,_(d.value.sendTime?t(R)(d.value.sendTime):"-"),1)]),n("div",ze,[e[35]||(e[35]=n("span",{class:"mr-2 font-bold"},"发送耗时:",-1)),n("span",null,_(d.value.duration?`${d.value.duration} ms`:"0 ms"),1)]),n("div",Fe,[e[36]||(e[36]=n("span",{class:"mr-2 font-bold"},"创建时间:",-1)),n("span",null,_(t(R)(d.value.createTime)),1)])])]),n("div",Ne,[n("div",Ue,[a(t(L).Title,{level:5,class:"mb-2"},{default:l(()=>[...e[37]||(e[37]=[r("通知内容",-1)])]),_:1}),n("div",Re,[n("div",{innerHTML:d.value.content},null,8,Je)])]),d.value.errorMessage?(G(),X("div",qe,[a(t(L).Title,{level:5,class:"mb-2"},{default:l(()=>[...e[38]||(e[38]=[r("错误信息",-1)])]),_:1}),n("div",$e,[n("pre",De,"                "+_(d.value.errorMessage)+`
              `,1)])])):Q("",!0)])])):Q("",!0),n("div",Ve,[a(t(x),{onClick:e[13]||(e[13]=s=>T.value=!1),type:"primary"},{default:l(()=>[...e[39]||(e[39]=[r("关闭",-1)])]),_:1})])]),_:1},8,["open","title"])]),_:1}))}}),$t=me(je,[["__scopeId","data-v-e5c8a6e2"]]);export{$t as default};

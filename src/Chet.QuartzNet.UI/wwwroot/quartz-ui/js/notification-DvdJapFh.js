var e=(e,t,l)=>new Promise((a,s)=>{var r=e=>{try{i(l.next(e))}catch(t){s(t)}},n=e=>{try{i(l.throw(e))}catch(t){s(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,n);i((l=l.apply(e,t)).next())});import{bW as t,a1 as l,c1 as a,ci as s,bG as r}from"./bootstrap-YsVmr8JV.js";import{T as n}from"./index-BdZuKG3I.js";import{M as i}from"./index-DETxA9x5.js";import{D as o,T as u}from"./index-CCpO-7E3.js";import{C as d}from"./index-B0kCKKle.js";import{F as c}from"./index-BF3RYuT-.js";import m from"./index-BBPOzr4q.js";import p from"./index-BoB-3r41.js";import v from"./index-BfoZMUll.js";import{T as f}from"./index-C52yjqC-.js";import{_ as g}from"./page.vue_vue_type_script_setup_true_lang-8N58SuSf.js";import{a1 as y,L as x,P as h,E as _,f as b,bG as j,aa as k,ai as O,aj as T,ak as I,p as w,a9 as C,aw as S,aU as P,as as z,an as F,ax as U}from"../jse/index-index-Cal9Ay2z.js";import{R as B,C as M}from"./index-BMfiHUoL.js";import R from"./index-CcclSR9f.js";import"./colors-CbnWixdr.js";import"./shallowequal-DEOIs-ld.js";import"./Trigger-BBbsStir.js";import"./ResizeObserver.es-C7U_o75s.js";import"./_arrayIncludes-DqeOlflt.js";import"./Overflow-CtSRiZmk.js";import"./index-CHYZDu-y.js";import"./index-ClxBeu6Y.js";import"./collapseMotion-dRwoh1gp.js";import"./slide-D8hkq2Bf.js";import"./index-B6Gf8sRe.js";import"./index-_ZRekdHt.js";import"./BaseInput-_kDVPvKF.js";import"./isMobile-VPrdNIIw.js";import"./DownOutlined-B0VTVyps.js";import"./CheckOutlined-7KxQ9e1J.js";import"./SearchOutlined-ehcWu5IC.js";import"./move-sm8Pa9uV.js";import"./index-fpW3RkY4.js";import"./index-GMO9qyC6.js";import"./responsiveObserve-BCIVev6J.js";import"./index-B7B4N6BD.js";import"./useMergedState-CyZc02xW.js";import"./index-RD8VoDfx.js";import"./Checkbox-B0WPqoh0.js";import"./FormItemContext-okSxWHmY.js";import"./index-Bd6qTxu8.js";import"./debounce-k3rRAVuo.js";import"./useRefs-B06P9vdR.js";import"./isPlainObject-QUT9gN3h.js";import"./Col-BNQq0Ra9.js";import"./useFlexGapSupport-BSSgcQ3N.js";import"./statusUtils-DO_uJOrb.js";import"./EyeOutlined-BDczgdwG.js";var J=(e=>(e[e.Pending=0]="Pending",e[e.Sent=1]="Sent",e[e.Failed=2]="Failed",e))(J||{});const q={class:"mb-4 flex items-center justify-between"},N={key:0,class:"notification-detail"},E={class:"detail-header mb-4 rounded-lg bg-gray-50 p-4"},G={class:"mb-3 flex items-center justify-between"},$={class:"mt-2 grid grid-cols-1 gap-4"},L={class:"flex items-center"},D={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},H={class:"flex items-center"},K={class:"flex items-center"},Q={class:"flex items-center"},W={class:"detail-content"},X={class:"mb-6"},A={class:"content-box rounded-lg border border-gray-200 bg-gray-50 p-4"},V=["innerHTML"],Y={key:0,class:"mb-6"},Z={class:"rounded-lg border border-red-200 bg-red-50 p-4"},ee={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm text-red-800"},te={class:"mt-4 flex justify-end"},le=r(y({__name:"notification",setup(r){const y={[J.Pending]:{text:"待发送",status:"default"},[J.Sent]:{text:"发送成功",status:"success"},[J.Failed]:{text:"发送失败",status:"error"}},le=x(!1),ae=x([]),se=x(0),re=x(1),ne=x(10),ie=x(!1),oe=x("通知详情"),ue=x(null),de=x(),ce=x({status:void 0,triggeredBy:""}),me=x(""),pe=x(void 0),ve=x(!1),fe=x("通知配置"),ge=h({token:"",channel:"wechat",template:"html",topic:"",enable:!1,strategy:{notifyOnJobSuccess:!1,notifyOnJobFailure:!0,notifyOnSchedulerError:!0}}),ye=x(),xe=_(()=>[{title:"通知标题",dataIndex:"title",ellipsis:!0},{title:"触发来源",dataIndex:"triggeredBy",ellipsis:!0},{title:"状态",dataIndex:"status",ellipsis:!0,customRender:({record:e})=>{const t=y[e.status];return{children:b(n,{color:(null==t?void 0:t.status)||"default"},(null==t?void 0:t.text)||e.status||"未知")}}},{title:"发送时间",dataIndex:"sendTime",ellipsis:!0,sorter:!0,sortOrder:"sendTime"===me.value?pe.value:void 0,customRender:({record:e})=>({children:e.sendTime?j(e.sendTime):"-"})},{title:"耗时(ms)",dataIndex:"duration",ellipsis:!0,sorter:!0,sortOrder:"duration"===me.value?pe.value:void 0},{title:"创建时间",dataIndex:"createTime",ellipsis:!0,sorter:!0,sortOrder:"createTime"===me.value?pe.value:void 0,customRender:({record:e})=>({children:e.createTime?j(e.createTime):"-"})},{title:"操作",key:"action",width:80,fixed:"right",customRender:({record:e})=>{const t=b(i.Item,{onClick:()=>we(e)},"详情"),a=b(i.Item,{onClick:()=>Ce(e),danger:!0},"删除"),s=b(i,null,[t,a]),r=b(l,{type:"primary",disabled:le.value},"操作");return{children:b(o,{trigger:["click"],overlay:s},()=>r)}}}]),he=_(()=>({current:re.value,pageSize:ne.value,total:se.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} 共 ${e} 条`,pageSizeOptions:["10","20","50","100"]})),_e=(e,t,l)=>{void 0!==e.current&&(re.value=e.current),void 0!==e.pageSize&&(ne.value=e.pageSize),void 0!==l.field&&(me.value=l.field,pe.value="ascend"===l.order?"ascend":"descend"===l.order?"descend":void 0),be()},be=()=>e(null,null,function*(){var l,a,r;le.value=!0;try{const s=yield(r={pageIndex:re.value,pageSize:ne.value,status:ce.value.status,triggeredBy:ce.value.triggeredBy,sortBy:me.value,sortOrder:pe.value},e(null,null,function*(){return yield t.post("/api/quartz/GetNotifications",r)}));ae.value=(null==(l=s.data)?void 0:l.items)||[],se.value=(null==(a=s.data)?void 0:a.totalCount)||0}catch(n){s.error("获取通知列表失败")}finally{le.value=!1}}),je=()=>e(null,null,function*(){de.value&&(yield de.value.validateFields()),re.value=1,be()}),ke=()=>{ce.value={status:void 0,triggeredBy:""},re.value=1,be()},Oe=()=>e(null,null,function*(){try{const l=yield e(null,null,function*(){return yield t.get("/api/quartz/GetPushPlusConfig")});Object.assign(ge,l.data),ve.value=!0}catch(l){s.error("获取配置失败")}}),Te=()=>e(null,null,function*(){var l;if(ye.value)try{yield ye.value.validateFields(),le.value=!0;const a=yield(l=ge,e(null,null,function*(){return yield t.post("/api/quartz/SavePushPlusConfig",l)}));a.success?(s.success("配置保存成功"),ve.value=!1):s.error(a.message||"配置保存失败")}catch(a){if(a.errorFields)return;const e=a.message||"配置保存失败";s.error(e)}finally{le.value=!1}}),Ie=()=>e(null,null,function*(){try{le.value=!0;const l=yield e(null,null,function*(){return yield t.post("/api/quartz/SendTestNotification")});l.success?(s.success("测试通知发送成功"),be()):s.error(l.message||"测试通知发送失败")}catch(l){s.error("测试通知发送失败")}finally{le.value=!1}}),we=e=>{ue.value=e,ie.value=!0},Ce=l=>{a.confirm({title:"确认删除",content:"确定要删除这条通知吗？此操作不可恢复。",okText:"确定",okType:"danger",cancelText:"取消",onOk(){return e(this,null,function*(){try{const r=yield(a=l.notificationId,e(null,null,function*(){return yield t.delete("/api/quartz/DeleteNotification",{params:{notificationId:a}})}));r.success?(s.success("通知删除成功"),be()):s.error(r.message||"通知删除失败")}catch(r){s.error("通知删除失败")}var a})}})},Se=()=>{a.confirm({title:"确认清空",content:"确定要清空所有符合条件的通知吗？此操作不可恢复。",okText:"确定",okType:"danger",cancelText:"取消",onOk(){return e(this,null,function*(){try{const a=yield(l={pageIndex:1,pageSize:1,status:ce.value.status,triggeredBy:ce.value.triggeredBy},e(null,null,function*(){return yield t.post("/api/quartz/ClearNotifications",l)}));a.success?(s.success("通知清空成功"),be()):s.error(a.message||"通知清空失败")}catch(a){s.error("通知清空失败")}var l})}})};return k(()=>{be()}),(e,t)=>(T(),O(C(g),null,{default:I(()=>[w(C(d),{class:"mb-4"},{default:I(()=>[w(C(c),{ref_key:"searchFormRef",ref:de,model:ce.value,layout:"horizontal","label-align":"right"},{default:I(()=>[w(C(B),{gutter:16},{default:I(()=>[w(C(M),{xs:24,sm:12,md:12,lg:8,xl:6,xxl:4},{default:I(()=>[w(C(c).Item,{label:"通知状态",name:"status"},{default:I(()=>[w(C(m),{value:ce.value.status,"onUpdate:value":t[0]||(t[0]=e=>ce.value.status=e),placeholder:"请选择状态",allowClear:""},{default:I(()=>[w(C(m).Option,{value:C(J).Pending},{default:I(()=>[...t[15]||(t[15]=[S("待发送",-1)])]),_:1},8,["value"]),w(C(m).Option,{value:C(J).Sent},{default:I(()=>[...t[16]||(t[16]=[S("发送成功",-1)])]),_:1},8,["value"]),w(C(m).Option,{value:C(J).Failed},{default:I(()=>[...t[17]||(t[17]=[S("发送失败",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1})]),_:1}),w(C(M),{xs:24,sm:12,md:12,lg:8,xl:6,xxl:4},{default:I(()=>[w(C(c).Item,{label:"触发来源",name:"triggeredBy"},{default:I(()=>[w(C(p),{value:ce.value.triggeredBy,"onUpdate:value":t[1]||(t[1]=e=>ce.value.triggeredBy=e),placeholder:"请输入触发来源"},null,8,["value"])]),_:1})]),_:1}),w(C(M),{xs:24,sm:24,md:24,lg:8,xl:12,xxl:16,class:"text-right"},{default:I(()=>[w(C(v),null,{default:I(()=>[w(C(l),{type:"primary",onClick:je},{default:I(()=>[...t[18]||(t[18]=[S("搜索",-1)])]),_:1}),w(C(l),{onClick:ke},{default:I(()=>[...t[19]||(t[19]=[S("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),w(C(d),null,{default:I(()=>[P("div",q,[w(C(v),null,{default:I(()=>[w(C(l),{type:"primary",onClick:Oe},{default:I(()=>[...t[20]||(t[20]=[S("通知配置",-1)])]),_:1}),w(C(l),{type:"default",onClick:Ie},{default:I(()=>[...t[21]||(t[21]=[S("发送测试通知",-1)])]),_:1})]),_:1}),w(C(v),null,{default:I(()=>[w(C(l),{danger:"",onClick:Se},{default:I(()=>[...t[22]||(t[22]=[S("清空",-1)])]),_:1})]),_:1})]),w(C(u),{columns:xe.value,"data-source":ae.value,pagination:he.value,loading:le.value,rowKey:e=>e.notificationId,onChange:_e,size:"middle",scroll:{x:"max-content"}},null,8,["columns","data-source","pagination","loading","rowKey"])]),_:1}),w(C(a),{open:ve.value,"onUpdate:open":t[11]||(t[11]=e=>ve.value=e),title:fe.value,width:"800px","body-style":{padding:"24px"},destroyOnClose:"",onCancel:t[12]||(t[12]=e=>ve.value=!1)},{footer:I(()=>[w(C(v),null,{default:I(()=>[w(C(l),{onClick:t[10]||(t[10]=e=>ve.value=!1)},{default:I(()=>[...t[31]||(t[31]=[S("取消",-1)])]),_:1}),w(C(l),{type:"primary",onClick:Te},{default:I(()=>[...t[32]||(t[32]=[S("保存",-1)])]),_:1})]),_:1})]),default:I(()=>[w(C(c),{ref_key:"formRef",ref:ye,model:ge,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18},"label-align":"right"},{default:I(()=>[w(C(B),{gutter:16},{default:I(()=>[w(C(M),{xs:24,sm:24,md:24},{default:I(()=>[w(C(c).Item,{label:"是否启用",name:"enable",valuePropName:"checked"},{default:I(()=>[w(C(R),{checked:ge.enable,"onUpdate:checked":t[2]||(t[2]=e=>ge.enable=e)},null,8,["checked"])]),_:1})]),_:1}),w(C(M),{xs:24,sm:24,md:24},{default:I(()=>[w(C(c).Item,{label:"Token",name:"token",rules:[{required:ge.enable,message:"请输入PushPlus Token"}]},{default:I(()=>[w(C(p),{value:ge.token,"onUpdate:value":t[3]||(t[3]=e=>ge.token=e),placeholder:"请输入PushPlus Token"},null,8,["value"])]),_:1},8,["rules"])]),_:1}),w(C(M),{xs:24,sm:24,md:24},{default:I(()=>[w(C(c).Item,{label:"推送渠道",name:"channel"},{default:I(()=>[w(C(m),{value:ge.channel,"onUpdate:value":t[4]||(t[4]=e=>ge.channel=e)},{default:I(()=>[w(C(m).Option,{value:"wechat"},{default:I(()=>[...t[23]||(t[23]=[S("微信",-1)])]),_:1}),w(C(m).Option,{value:"cp"},{default:I(()=>[...t[24]||(t[24]=[S("企业微信",-1)])]),_:1}),w(C(m).Option,{value:"webhook"},{default:I(()=>[...t[25]||(t[25]=[S("钉钉",-1)])]),_:1}),w(C(m).Option,{value:"mail"},{default:I(()=>[...t[26]||(t[26]=[S("邮件",-1)])]),_:1}),w(C(m).Option,{value:"sms"},{default:I(()=>[...t[27]||(t[27]=[S("短信",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),w(C(M),{xs:24,sm:24,md:24},{default:I(()=>[w(C(c).Item,{label:"消息模板",name:"template"},{default:I(()=>[w(C(m),{value:ge.template,"onUpdate:value":t[5]||(t[5]=e=>ge.template=e)},{default:I(()=>[w(C(m).Option,{value:"html"},{default:I(()=>[...t[28]||(t[28]=[S("HTML",-1)])]),_:1}),w(C(m).Option,{value:"text"},{default:I(()=>[...t[29]||(t[29]=[S("TEXT",-1)])]),_:1}),w(C(m).Option,{value:"markdown"},{default:I(()=>[...t[30]||(t[30]=[S("Markdown",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),w(C(M),{xs:24,sm:24,md:24},{default:I(()=>[w(C(c).Item,{label:"主题",name:"topic"},{default:I(()=>[w(C(p),{value:ge.topic,"onUpdate:value":t[6]||(t[6]=e=>ge.topic=e),placeholder:"请输入主题（可选）"},null,8,["value"])]),_:1})]),_:1}),w(C(M),{xs:24,sm:24,md:24},{default:I(()=>[w(C(c).Item,{label:"通知策略",class:"mt-4"},{default:I(()=>[w(C(c).Item,{label:"作业成功时发送",name:"strategy.notifyOnJobSuccess",valuePropName:"checked"},{default:I(()=>[w(C(R),{checked:ge.strategy.notifyOnJobSuccess,"onUpdate:checked":t[7]||(t[7]=e=>ge.strategy.notifyOnJobSuccess=e)},null,8,["checked"])]),_:1}),w(C(c).Item,{label:"作业失败时发送",name:"strategy.notifyOnJobFailure",valuePropName:"checked"},{default:I(()=>[w(C(R),{checked:ge.strategy.notifyOnJobFailure,"onUpdate:checked":t[8]||(t[8]=e=>ge.strategy.notifyOnJobFailure=e)},null,8,["checked"])]),_:1}),w(C(c).Item,{label:"调度器异常时发送",name:"strategy.notifyOnSchedulerError",valuePropName:"checked"},{default:I(()=>[w(C(R),{checked:ge.strategy.notifyOnSchedulerError,"onUpdate:checked":t[9]||(t[9]=e=>ge.strategy.notifyOnSchedulerError=e)},null,8,["checked"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"]),w(C(a),{open:ie.value,"onUpdate:open":t[14]||(t[14]=e=>ie.value=e),title:oe.value,width:"1000px",footer:null,destroyOnClose:!0},{default:I(()=>[ue.value?(T(),z("div",N,[P("div",E,[P("div",G,[w(C(f).Title,{level:4,class:"m-0"},{default:I(()=>[S(U(ue.value.title),1)]),_:1}),w(C(n),{color:y[ue.value.status].status,class:"text-lg"},{default:I(()=>[S(U(y[ue.value.status].text),1)]),_:1},8,["color"])]),P("div",$,[P("div",L,[t[33]||(t[33]=P("span",{class:"mr-2 font-bold"},"触发来源:",-1)),P("span",null,U(ue.value.triggeredBy||"-"),1)]),P("div",D,[P("div",H,[t[34]||(t[34]=P("span",{class:"mr-2 font-bold"},"发送时间:",-1)),P("span",null,U(ue.value.sendTime?C(j)(ue.value.sendTime):"-"),1)]),P("div",K,[t[35]||(t[35]=P("span",{class:"mr-2 font-bold"},"发送耗时:",-1)),P("span",null,U(ue.value.duration?`${ue.value.duration} ms`:"0 ms"),1)]),P("div",Q,[t[36]||(t[36]=P("span",{class:"mr-2 font-bold"},"创建时间:",-1)),P("span",null,U(C(j)(ue.value.createTime)),1)])])])]),P("div",W,[P("div",X,[w(C(f).Title,{level:5,class:"mb-2"},{default:I(()=>[...t[37]||(t[37]=[S("通知内容",-1)])]),_:1}),P("div",A,[P("div",{innerHTML:ue.value.content},null,8,V)])]),ue.value.errorMessage?(T(),z("div",Y,[w(C(f).Title,{level:5,class:"mb-2"},{default:I(()=>[...t[38]||(t[38]=[S("错误信息",-1)])]),_:1}),P("div",Z,[P("pre",ee,U(ue.value.errorMessage),1)])])):F("",!0)])])):F("",!0),P("div",te,[w(C(l),{onClick:t[13]||(t[13]=e=>ie.value=!1),type:"primary"},{default:I(()=>[...t[39]||(t[39]=[S("关闭",-1)])]),_:1})])]),_:1},8,["open","title"])]),_:1}))}}),[["__scopeId","data-v-1b2a7753"]]);export{le as default};

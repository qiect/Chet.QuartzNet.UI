var e=(e,t,l)=>new Promise((a,s)=>{var r=e=>{try{i(l.next(e))}catch(t){s(t)}},n=e=>{try{i(l.throw(e))}catch(t){s(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,n);i((l=l.apply(e,t)).next())});import{bX as t,a1 as l,c1 as a,ci as s,bG as r}from"./bootstrap-DWxdiVxZ.js";import{T as n}from"./index-DzHjQFMG.js";import{M as i}from"./index-o_hZhFK-.js";import{D as o,T as u}from"./index-B_3GfhMc.js";import{C as d}from"./index-BMbZjfh-.js";import{F as c}from"./index-eTnl57kj.js";import m from"./index-D1Ruqo4i.js";import p from"./index-DikxPhV0.js";import v from"./index-CvD6tvFX.js";import{T as f}from"./index-D4rW2b7W.js";import{_ as g}from"./page.vue_vue_type_script_setup_true_lang-D6t3jcSl.js";import{a1 as y,L as h,P as x,E as _,f as b,bG as j,aa as k,ai as O,aj as T,ak as w,p as I,a9 as C,aw as S,aU as P,as as z,an as F,ax as U}from"../jse/index-index-CIvC8h5Q.js";import{R as B,C as M}from"./index-DCZHKSxy.js";import R from"./index-CVrbScwb.js";import"./colors-D9eRBsxj.js";import"./shallowequal-BEztxY_O.js";import"./Trigger-Dqim-gg8.js";import"./ResizeObserver.es-C7U_o75s.js";import"./_arrayIncludes-DqeOlflt.js";import"./Overflow-D5NQ_5Pz.js";import"./index-DqLpbM1O.js";import"./index-CwdUNuLp.js";import"./collapseMotion-YYCdnzQX.js";import"./slide-DrX_c3J2.js";import"./index-B-TQBI6Y.js";import"./index-DJYsa1gq.js";import"./BaseInput-Cqq20XOV.js";import"./isMobile-VPrdNIIw.js";import"./DownOutlined-DV4BPUH_.js";import"./CheckOutlined-BEGudAA2.js";import"./SearchOutlined-B76O0-pn.js";import"./move-O8IwU3wu.js";import"./index-C49OUeuh.js";import"./index-C4EG0E4v.js";import"./responsiveObserve-Cff2hvra.js";import"./index-D7t9SmTO.js";import"./useMergedState-JQ0bKNxu.js";import"./index-ylU5NdkS.js";import"./Checkbox-D5K2oZJS.js";import"./FormItemContext-C10w-ynQ.js";import"./index-DO0PHS7J.js";import"./debounce-VF9DGj1X.js";import"./useRefs-B-R_N8G_.js";import"./isPlainObject-BsVqtozh.js";import"./Col-YecmC0Eq.js";import"./useFlexGapSupport-C36GdjM3.js";import"./statusUtils-CJgt7IBU.js";import"./EyeOutlined-WwZ2_54Q.js";var J=(e=>(e[e.Pending=0]="Pending",e[e.Sent=1]="Sent",e[e.Failed=2]="Failed",e))(J||{});const q={class:"mb-4 flex items-center justify-between"},N={key:0,class:"notification-detail"},E={class:"detail-header mb-4 rounded-lg bg-gray-50 p-4"},G={class:"mb-3 flex items-center justify-between"},$={class:"mt-2 grid grid-cols-1 gap-4 md:grid-cols-4"},L={class:"flex items-center"},D={class:"flex items-center"},H={class:"flex items-center"},X={class:"flex items-center"},K={class:"detail-content"},Q={class:"mb-6"},A={class:"content-box rounded-lg border border-gray-200 bg-gray-50 p-4"},V=["innerHTML"],W={key:0,class:"mb-6"},Y={class:"rounded-lg border border-red-200 bg-red-50 p-4"},Z={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm text-red-800"},ee={class:"mt-4 flex justify-end"},te=r(y({__name:"notification",setup(r){const y={[J.Pending]:{text:"待发送",status:"default"},[J.Sent]:{text:"发送成功",status:"success"},[J.Failed]:{text:"发送失败",status:"error"}},te=h(!1),le=h([]),ae=h(0),se=h(1),re=h(10),ne=h(!1),ie=h("通知详情"),oe=h(null),ue=h(),de=h({status:void 0,triggeredBy:""}),ce=h(""),me=h(void 0),pe=h(!1),ve=h("通知配置"),fe=x({token:"",channel:"wechat",template:"html",topic:"",enable:!1,strategy:{notifyOnJobSuccess:!1,notifyOnJobFailure:!0,notifyOnSchedulerError:!0}}),ge=h(),ye=_(()=>[{title:"通知标题",dataIndex:"title",ellipsis:!0},{title:"触发来源",dataIndex:"triggeredBy",ellipsis:!0},{title:"状态",dataIndex:"status",ellipsis:!0,customRender:({record:e})=>{const t=y[e.status];return{children:b(n,{color:(null==t?void 0:t.status)||"default"},(null==t?void 0:t.text)||e.status||"未知")}}},{title:"发送时间",dataIndex:"sendTime",ellipsis:!0,sorter:!0,sortOrder:"sendTime"===ce.value?me.value:void 0,customRender:({record:e})=>({children:e.sendTime?j(e.sendTime):"-"})},{title:"耗时(ms)",dataIndex:"duration",ellipsis:!0,sorter:!0,sortOrder:"duration"===ce.value?me.value:void 0},{title:"创建时间",dataIndex:"createTime",ellipsis:!0,sorter:!0,sortOrder:"createTime"===ce.value?me.value:void 0,customRender:({record:e})=>({children:e.createTime?j(e.createTime):"-"})},{title:"操作",key:"action",width:80,customRender:({record:e})=>{const t=b(i.Item,{onClick:()=>we(e)},"详情"),a=b(i.Item,{onClick:()=>Ie(e),danger:!0},"删除"),s=b(i,null,[t,a]),r=b(l,{type:"primary",disabled:te.value},"操作");return{children:b(o,{trigger:["click"],overlay:s},()=>r)}}}]),he=_(()=>({current:se.value,pageSize:re.value,total:ae.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`${t[0]}-${t[1]} 共 ${e} 条`,pageSizeOptions:["10","20","50","100"]})),xe=(e,t,l)=>{void 0!==e.current&&(se.value=e.current),void 0!==e.pageSize&&(re.value=e.pageSize),void 0!==l.field&&(ce.value=l.field,me.value="ascend"===l.order?"ascend":"descend"===l.order?"descend":void 0),_e()},_e=()=>e(null,null,function*(){var l,a,r;te.value=!0;try{const s=yield(r={pageIndex:se.value,pageSize:re.value,status:de.value.status,triggeredBy:de.value.triggeredBy,sortBy:ce.value,sortOrder:me.value},e(null,null,function*(){return yield t.post("/api/quartz/GetNotifications",r)}));le.value=(null==(l=s.data)?void 0:l.items)||[],ae.value=(null==(a=s.data)?void 0:a.totalCount)||0}catch(n){s.error("获取通知列表失败")}finally{te.value=!1}}),be=()=>e(null,null,function*(){ue.value&&(yield ue.value.validateFields()),se.value=1,_e()}),je=()=>{de.value={status:void 0,triggeredBy:""},se.value=1,_e()},ke=()=>e(null,null,function*(){try{const l=yield e(null,null,function*(){return yield t.get("/api/quartz/GetPushPlusConfig")});Object.assign(fe,l.data),pe.value=!0}catch(l){s.error("获取配置失败")}}),Oe=()=>e(null,null,function*(){var l;if(ge.value)try{yield ge.value.validateFields(),te.value=!0;const a=yield(l=fe,e(null,null,function*(){return yield t.post("/api/quartz/SavePushPlusConfig",l)}));a.success?(s.success("配置保存成功"),pe.value=!1):s.error(a.message||"配置保存失败")}catch(a){if(a.errorFields)return;const e=a.message||"配置保存失败";s.error(e)}finally{te.value=!1}}),Te=()=>e(null,null,function*(){try{te.value=!0;const l=yield e(null,null,function*(){return yield t.post("/api/quartz/SendTestNotification")});l.success?(s.success("测试通知发送成功"),_e()):s.error(l.message||"测试通知发送失败")}catch(l){s.error("测试通知发送失败")}finally{te.value=!1}}),we=e=>{oe.value=e,ne.value=!0},Ie=l=>{a.confirm({title:"确认删除",content:"确定要删除这条通知吗？此操作不可恢复。",okText:"确定",okType:"danger",cancelText:"取消",onOk(){return e(this,null,function*(){try{const r=yield(a=l.notificationId,e(null,null,function*(){return yield t.delete("/api/quartz/DeleteNotification",{params:{notificationId:a}})}));r.success?(s.success("通知删除成功"),_e()):s.error(r.message||"通知删除失败")}catch(r){s.error("通知删除失败")}var a})}})},Ce=()=>{a.confirm({title:"确认清空",content:"确定要清空所有符合条件的通知吗？此操作不可恢复。",okText:"确定",okType:"danger",cancelText:"取消",onOk(){return e(this,null,function*(){try{const a=yield(l={pageIndex:1,pageSize:1,status:de.value.status,triggeredBy:de.value.triggeredBy},e(null,null,function*(){return yield t.post("/api/quartz/ClearNotifications",l)}));a.success?(s.success("通知清空成功"),_e()):s.error(a.message||"通知清空失败")}catch(a){s.error("通知清空失败")}var l})}})};return k(()=>{_e()}),(e,t)=>(T(),O(C(g),null,{default:w(()=>[I(C(d),{class:"mb-4"},{default:w(()=>[I(C(c),{ref_key:"searchFormRef",ref:ue,model:de.value,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18},"label-align":"right"},{default:w(()=>[I(C(B),{gutter:16},{default:w(()=>[I(C(M),{xs:24,sm:12,md:8,lg:8},{default:w(()=>[I(C(c).Item,{label:"通知状态",name:"status"},{default:w(()=>[I(C(m),{value:de.value.status,"onUpdate:value":t[0]||(t[0]=e=>de.value.status=e),placeholder:"请选择状态",allowClear:""},{default:w(()=>[I(C(m).Option,{value:C(J).Pending},{default:w(()=>[...t[15]||(t[15]=[S("待发送",-1)])]),_:1},8,["value"]),I(C(m).Option,{value:C(J).Sent},{default:w(()=>[...t[16]||(t[16]=[S("发送成功",-1)])]),_:1},8,["value"]),I(C(m).Option,{value:C(J).Failed},{default:w(()=>[...t[17]||(t[17]=[S("发送失败",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1})]),_:1}),I(C(M),{xs:24,sm:12,md:8,lg:8},{default:w(()=>[I(C(c).Item,{label:"触发来源",name:"triggeredBy"},{default:w(()=>[I(C(p),{value:de.value.triggeredBy,"onUpdate:value":t[1]||(t[1]=e=>de.value.triggeredBy=e),placeholder:"请输入触发来源"},null,8,["value"])]),_:1})]),_:1}),I(C(M),{xs:24,sm:24,md:24,lg:8,class:"text-right"},{default:w(()=>[I(C(v),null,{default:w(()=>[I(C(l),{type:"primary",onClick:be},{default:w(()=>[...t[18]||(t[18]=[S("搜索",-1)])]),_:1}),I(C(l),{onClick:je},{default:w(()=>[...t[19]||(t[19]=[S("重置",-1)])]),_:1}),I(C(l),{danger:"",onClick:Ce},{default:w(()=>[...t[20]||(t[20]=[S("清空",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),I(C(d),null,{default:w(()=>[P("div",q,[I(C(v),null,{default:w(()=>[I(C(l),{type:"primary",onClick:ke},{default:w(()=>[...t[21]||(t[21]=[S("通知配置",-1)])]),_:1}),I(C(l),{type:"default",onClick:Te},{default:w(()=>[...t[22]||(t[22]=[S("发送测试通知",-1)])]),_:1})]),_:1})]),I(C(u),{columns:ye.value,"data-source":le.value,pagination:he.value,loading:te.value,rowKey:e=>e.notificationId,onChange:xe,size:"middle",scroll:{x:"max-content"}},null,8,["columns","data-source","pagination","loading","rowKey"])]),_:1}),I(C(a),{visible:pe.value,"onUpdate:visible":t[11]||(t[11]=e=>pe.value=e),title:ve.value,width:"800px","body-style":{padding:"24px"},destroyOnClose:"",onCancel:t[12]||(t[12]=e=>pe.value=!1)},{footer:w(()=>[I(C(v),null,{default:w(()=>[I(C(l),{onClick:t[10]||(t[10]=e=>pe.value=!1)},{default:w(()=>[...t[31]||(t[31]=[S("取消",-1)])]),_:1}),I(C(l),{type:"primary",onClick:Oe},{default:w(()=>[...t[32]||(t[32]=[S("保存",-1)])]),_:1})]),_:1})]),default:w(()=>[I(C(c),{ref_key:"formRef",ref:ge,model:fe,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18},"label-align":"right"},{default:w(()=>[I(C(B),{gutter:16},{default:w(()=>[I(C(M),{xs:24,sm:24,md:24},{default:w(()=>[I(C(c).Item,{label:"是否启用",name:"enable",valuePropName:"checked"},{default:w(()=>[I(C(R),{checked:fe.enable,"onUpdate:checked":t[2]||(t[2]=e=>fe.enable=e)},null,8,["checked"])]),_:1})]),_:1}),I(C(M),{xs:24,sm:24,md:24},{default:w(()=>[I(C(c).Item,{label:"Token",name:"token",rules:[{required:fe.enable,message:"请输入PushPlus Token"}]},{default:w(()=>[I(C(p),{value:fe.token,"onUpdate:value":t[3]||(t[3]=e=>fe.token=e),placeholder:"请输入PushPlus Token"},null,8,["value"])]),_:1},8,["rules"])]),_:1}),I(C(M),{xs:24,sm:24,md:24},{default:w(()=>[I(C(c).Item,{label:"推送渠道",name:"channel"},{default:w(()=>[I(C(m),{value:fe.channel,"onUpdate:value":t[4]||(t[4]=e=>fe.channel=e)},{default:w(()=>[I(C(m).Option,{value:"wechat"},{default:w(()=>[...t[23]||(t[23]=[S("微信",-1)])]),_:1}),I(C(m).Option,{value:"cp"},{default:w(()=>[...t[24]||(t[24]=[S("企业微信",-1)])]),_:1}),I(C(m).Option,{value:"webhook"},{default:w(()=>[...t[25]||(t[25]=[S("钉钉",-1)])]),_:1}),I(C(m).Option,{value:"mail"},{default:w(()=>[...t[26]||(t[26]=[S("邮件",-1)])]),_:1}),I(C(m).Option,{value:"sms"},{default:w(()=>[...t[27]||(t[27]=[S("短信",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),I(C(M),{xs:24,sm:24,md:24},{default:w(()=>[I(C(c).Item,{label:"消息模板",name:"template"},{default:w(()=>[I(C(m),{value:fe.template,"onUpdate:value":t[5]||(t[5]=e=>fe.template=e)},{default:w(()=>[I(C(m).Option,{value:"html"},{default:w(()=>[...t[28]||(t[28]=[S("HTML",-1)])]),_:1}),I(C(m).Option,{value:"text"},{default:w(()=>[...t[29]||(t[29]=[S("TEXT",-1)])]),_:1}),I(C(m).Option,{value:"markdown"},{default:w(()=>[...t[30]||(t[30]=[S("Markdown",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),I(C(M),{xs:24,sm:24,md:24},{default:w(()=>[I(C(c).Item,{label:"主题",name:"topic"},{default:w(()=>[I(C(p),{value:fe.topic,"onUpdate:value":t[6]||(t[6]=e=>fe.topic=e),placeholder:"请输入主题（可选）"},null,8,["value"])]),_:1})]),_:1}),I(C(M),{xs:24,sm:24,md:24},{default:w(()=>[I(C(c).Item,{label:"通知策略",class:"mt-4"},{default:w(()=>[I(C(c).Item,{label:"作业成功时发送",name:"strategy.notifyOnJobSuccess",valuePropName:"checked"},{default:w(()=>[I(C(R),{checked:fe.strategy.notifyOnJobSuccess,"onUpdate:checked":t[7]||(t[7]=e=>fe.strategy.notifyOnJobSuccess=e)},null,8,["checked"])]),_:1}),I(C(c).Item,{label:"作业失败时发送",name:"strategy.notifyOnJobFailure",valuePropName:"checked"},{default:w(()=>[I(C(R),{checked:fe.strategy.notifyOnJobFailure,"onUpdate:checked":t[8]||(t[8]=e=>fe.strategy.notifyOnJobFailure=e)},null,8,["checked"])]),_:1}),I(C(c).Item,{label:"调度器异常时发送",name:"strategy.notifyOnSchedulerError",valuePropName:"checked"},{default:w(()=>[I(C(R),{checked:fe.strategy.notifyOnSchedulerError,"onUpdate:checked":t[9]||(t[9]=e=>fe.strategy.notifyOnSchedulerError=e)},null,8,["checked"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"]),I(C(a),{open:ne.value,"onUpdate:open":t[14]||(t[14]=e=>ne.value=e),title:ie.value,width:"1000px",footer:null,destroyOnClose:!0},{default:w(()=>[oe.value?(T(),z("div",N,[P("div",E,[P("div",G,[I(C(f).Title,{level:4,class:"m-0"},{default:w(()=>[S(U(oe.value.title),1)]),_:1}),I(C(n),{color:y[oe.value.status].status,class:"text-lg"},{default:w(()=>[S(U(y[oe.value.status].text),1)]),_:1},8,["color"])]),P("div",$,[P("div",L,[t[33]||(t[33]=P("span",{class:"mr-2 font-bold"},"触发来源:",-1)),P("span",null,U(oe.value.triggeredBy||"-"),1)]),P("div",D,[t[34]||(t[34]=P("span",{class:"mr-2 font-bold"},"发送时间:",-1)),P("span",null,U(oe.value.sendTime?C(j)(oe.value.sendTime):"-"),1)]),P("div",H,[t[35]||(t[35]=P("span",{class:"mr-2 font-bold"},"发送耗时:",-1)),P("span",null,U(oe.value.duration?`${oe.value.duration} ms`:"0 ms"),1)]),P("div",X,[t[36]||(t[36]=P("span",{class:"mr-2 font-bold"},"创建时间:",-1)),P("span",null,U(C(j)(oe.value.createTime)),1)])])]),P("div",K,[P("div",Q,[I(C(f).Title,{level:5,class:"mb-2"},{default:w(()=>[...t[37]||(t[37]=[S("通知内容",-1)])]),_:1}),P("div",A,[P("div",{innerHTML:oe.value.content},null,8,V)])]),oe.value.errorMessage?(T(),z("div",W,[I(C(f).Title,{level:5,class:"mb-2"},{default:w(()=>[...t[38]||(t[38]=[S("错误信息",-1)])]),_:1}),P("div",Y,[P("pre",Z,"                "+U(oe.value.errorMessage)+"\n              ",1)])])):F("",!0)])])):F("",!0),P("div",ee,[I(C(l),{onClick:t[13]||(t[13]=e=>ne.value=!1),type:"primary"},{default:w(()=>[...t[39]||(t[39]=[S("关闭",-1)])]),_:1})])]),_:1},8,["open","title"])]),_:1}))}}),[["__scopeId","data-v-e5c8a6e2"]]);export{te as default};

var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,i=(e,a,t)=>new Promise((s,l)=>{var r=e=>{try{i(t.next(e))}catch(a){l(a)}},o=e=>{try{i(t.throw(e))}catch(a){l(a)}},i=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,o);i((t=t.apply(e,a)).next())});import{bW as d,a1 as n,c6 as u,cn as c,bG as m}from"./bootstrap-BadVN9sI.js";import{T as p}from"./index-EpWeNISZ.js";import{a as v,R as f,C as x}from"./index-Cn4YNJfq.js";import{F as j}from"./index-CivAdk6l.js";import b from"./index-CDEWuxHF.js";import g from"./index-BSNBr20x.js";import{D as y}from"./dayjs-Sciw3wmW.js";import _ from"./index-CGe3sslt.js";import{T as w}from"./index-NQclCTRw.js";import{T as h}from"./index-BQm8TjL9.js";import{_ as k}from"./page.vue_vue_type_script_setup_true_lang-DP_Amf6O.js";import{a1 as T,L as O,P as C,E as S,f as R,bG as I,ai as N,aj as U,ak as G,p as z,a9 as E,as as P,an as D,aw as F,F as $,aU as M,ax as J}from"../jse/index-index-Cr7_Iy4w.js";import"./colors-B7qYdav-.js";import"./index-CiA9X-jd.js";import"./shallowequal-Cz8Fa_Xp.js";import"./Trigger-84iPrD0t.js";import"./ResizeObserver.es-C7U_o75s.js";import"./_arrayIncludes-DqeOlflt.js";import"./Overflow-YWJLS19G.js";import"./index-BiGGUOep.js";import"./index-BWx2voRO.js";import"./collapseMotion-B8Lieczr.js";import"./slide-DRHo-HhO.js";import"./Dropdown-BBJyOr0O.js";import"./useRefs-DktFujrz.js";import"./Col-o6Q8T3dC.js";import"./responsiveObserve-C-l2EFpW.js";import"./useFlexGapSupport-DxLOHxJe.js";import"./isMobile-VPrdNIIw.js";import"./useMergedState-BIlYqaPD.js";import"./isPlainObject-DoKaImFs.js";import"./debounce-BQNges-p.js";import"./FormItemContext-Br2xbg7H.js";import"./statusUtils-CmtbPfm6.js";import"./BaseInput-Dy05JdzI.js";import"./index-BWMVVXcc.js";import"./SearchOutlined-BQRBTVxk.js";import"./EyeOutlined-C3ItWeA9.js";import"./index-CNoCiUIH.js";import"./DownOutlined-CdPTvWsS.js";import"./CheckOutlined-DTccDwD4.js";import"./move-C4bgQOQJ.js";import"./index-NX46mjS4.js";import"./index-B6bzgkY9.js";import"./index-BC6VGsar.js";import"./index-BNkj7F8O.js";import"./index-CvW6D6FC.js";import"./Checkbox-CmMpPyr_.js";import"./index-DXXFMsAT.js";var q=(e=>(e[e.RUNNING=0]="RUNNING",e[e.SUCCESS=1]="SUCCESS",e[e.ERROR=2]="ERROR",e))(q||{});const A={class:"mb-4 flex items-center justify-end"},B={key:0,class:"log-detail"},L={class:"detail-header mb-4 rounded-lg p-5"},K={class:"mb-4 flex flex-wrap items-center justify-between gap-3"},Q={class:"mt-3 grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3"},W={class:"info-item flex items-center gap-2 p-2 rounded"},V={class:"text-sm font-medium"},X={class:"info-item flex items-center gap-2 p-2 rounded"},Y={class:"text-sm"},Z={class:"info-item flex items-center gap-2 p-2 rounded"},H={class:"text-sm"},ee={class:"detail-content space-y-6"},ae={class:"content-section"},te={class:"content-card exec-info-card rounded-lg p-4"},se={class:"code-block word-break-break-word m-0 whitespace-pre-wrap text-sm"},le={key:0,class:"content-section"},re={class:"content-card error-card rounded-lg p-4"},oe={class:"code-block word-break-break-word m-0 whitespace-pre-wrap text-sm"},ie={key:1,class:"content-section"},de={class:"content-card error-card rounded-lg p-4"},ne={class:"code-block word-break-break-word m-0 whitespace-pre-wrap text-sm"},ue={key:2,class:"content-section"},ce={class:"content-card success-card rounded-lg p-4"},me={class:"code-block word-break-break-word m-0 whitespace-pre-wrap text-sm"},pe={key:3,class:"content-section"},ve={class:"content-card info-card rounded-lg p-4"},fe={class:"code-block word-break-break-word m-0 whitespace-pre-wrap text-sm"},xe={class:"mt-6 flex justify-end"},je=m(T({__name:"log",setup(e){const m={[q.SUCCESS]:{text:"成功",status:"success"},[q.ERROR]:{text:"失败",status:"error"},[q.RUNNING]:{text:"运行中",status:"processing"}},T=O(!1),je=O([]),be=O(0),ge=O(1),ye=O(10),_e=O(),we=C({jobName:"",jobGroup:"",status:void 0,startTime:void 0,endTime:void 0}),he=O(!1),ke=O(!1),Te=O("日志详情"),Oe=O(null),Ce=O(""),Se=O(""),Re=S(()=>[{title:"作业名称",dataIndex:"jobName",ellipsis:!0},{title:"作业分组",dataIndex:"jobGroup",ellipsis:!0},{title:"状态",dataIndex:"status",customRender:({record:e})=>{const a=m[e.status];return R(p,{color:a.status},{default:()=>(null==a?void 0:a.text)||"未知"})}},{title:"开始时间",dataIndex:"startTime",ellipsis:!0,sorter:!0,sortOrder:"startTime"===Ce.value?"asc"===Se.value?"ascend":"desc"===Se.value?"descend":void 0:void 0,customRender:({record:e})=>e.startTime?I(e.startTime):"-"},{title:"结束时间",dataIndex:"endTime",ellipsis:!0,sorter:!0,sortOrder:"endTime"===Ce.value?"asc"===Se.value?"ascend":"desc"===Se.value?"descend":void 0:void 0,customRender:({record:e})=>e.endTime?I(e.endTime):"-"},{title:"执行时长(ms)",dataIndex:"duration",ellipsis:!0,sorter:!0,sortOrder:"duration"===Ce.value?"asc"===Se.value?"ascend":"desc"===Se.value?"descend":void 0:void 0},{title:"操作",width:80,key:"action",fixed:"right",slots:{customRender:"action"}}]),Ie=S(()=>({current:ge.value,pageSize:ye.value,total:be.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} 共 ${e} 条`,pageSizeOptions:["10","20","50","100"]})),Ne=()=>i(null,null,function*(){T.value=!0;try{const u=yield function(e){return i(this,null,function*(){return d.post("/api/quartz/GetJobLogs",e)})}((e=((e,a)=>{for(var t in a||(a={}))l.call(a,t)&&o(e,t,a[t]);if(s)for(var t of s(a))r.call(a,t)&&o(e,t,a[t]);return e})({},we),n={pageIndex:ge.value||1,pageSize:ye.value||10,sortBy:Ce.value,sortOrder:Se.value},a(e,t(n))));if(u.success)u.data&&u.data.items&&Array.isArray(u.data.items)?(je.value=u.data.items,be.value=u.data.totalCount||0):(je.value=[],be.value=0);else{const e=u.errorCode?`${u.message||"获取日志列表失败"} (错误码: ${u.errorCode})`:u.message||"获取日志列表失败";c.error(e),je.value=[],be.value=0}}catch(u){c.error("object"==typeof u&&null!==u&&"message"in u?String(u.message):"获取日志列表失败"),je.value=[],be.value=0}finally{T.value=!1}var e,n}),Ue=(e,a,t)=>{void 0!==e.current&&(ge.value=e.current),void 0!==e.pageSize&&(ye.value=e.pageSize),void 0!==t.field&&(Ce.value=t.field,Se.value="ascend"===t.order?"asc":"descend"===t.order?"desc":""),Ne()},Ge=()=>i(null,null,function*(){_e.value&&(yield _e.value.validateFields()),ge.value=1,Ne()}),ze=()=>{_e.value&&_e.value.resetFields(),ge.value=1,Ne()},Ee=()=>{u.confirm({title:"确认清空",content:"确定要清空日志吗？此操作不可恢复！",onOk:()=>i(null,null,function*(){try{const e=yield function(){return i(this,arguments,function*(e={}){return yield d.post("/api/quartz/ClearLogs",e)})}({jobName:"",jobGroup:"",status:void 0,startTime:void 0,endTime:void 0});e.success?(c.success("日志清空成功"),yield Ne()):c.error(e.message||"日志清空失败")}catch(e){c.error(e.message||"日志清空失败")}})})};return i(null,null,function*(){yield Ne()}),(e,a)=>(U(),N(E(k),{"auto-content-height":""},{default:G(()=>[z(E(v),{class:"mb-4"},{default:G(()=>[z(E(j),{ref_key:"searchFormRef",ref:_e,model:we,layout:"horizontal","label-align":"right"},{default:G(()=>[z(E(f),{gutter:16},{default:G(()=>[z(E(x),{xs:24,sm:12,md:12,lg:8,xl:4},{default:G(()=>[z(E(j).Item,{label:"作业名称",name:"jobName"},{default:G(()=>[z(E(b),{value:we.jobName,"onUpdate:value":a[0]||(a[0]=e=>we.jobName=e),placeholder:"请输入作业名称"},null,8,["value"])]),_:1})]),_:1}),z(E(x),{xs:24,sm:12,md:12,lg:8,xl:4},{default:G(()=>[z(E(j).Item,{label:"作业分组",name:"jobGroup"},{default:G(()=>[z(E(b),{value:we.jobGroup,"onUpdate:value":a[1]||(a[1]=e=>we.jobGroup=e),placeholder:"请输入作业分组"},null,8,["value"])]),_:1})]),_:1}),z(E(x),{xs:24,sm:12,md:12,lg:8,xl:4},{default:G(()=>[z(E(j).Item,{label:"执行状态",name:"status"},{default:G(()=>[z(E(g),{value:we.status,"onUpdate:value":a[2]||(a[2]=e=>we.status=e),placeholder:"请选择状态",allowClear:""},{default:G(()=>[z(E(g).Option,{value:E(q).SUCCESS},{default:G(()=>[...a[7]||(a[7]=[F("成功",-1)])]),_:1},8,["value"]),z(E(g).Option,{value:E(q).ERROR},{default:G(()=>[...a[8]||(a[8]=[F("失败",-1)])]),_:1},8,["value"]),z(E(g).Option,{value:E(q).RUNNING},{default:G(()=>[...a[9]||(a[9]=[F("运行中",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1})]),_:1}),z(E(x),{xs:24,sm:12,md:12,lg:8,xl:4},{default:G(()=>[z(E(j).Item,{label:"开始时间",name:"startTime"},{default:G(()=>[z(E(y),{value:we.startTime,"onUpdate:value":a[3]||(a[3]=e=>we.startTime=e),showTime:"",placeholder:"选择开始时间"},null,8,["value"])]),_:1})]),_:1}),z(E(x),{xs:24,sm:12,md:12,lg:8,xl:4},{default:G(()=>[z(E(j).Item,{label:"结束时间",name:"endTime"},{default:G(()=>[z(E(y),{value:we.endTime,"onUpdate:value":a[4]||(a[4]=e=>we.endTime=e),showTime:"",placeholder:"选择结束时间"},null,8,["value"])]),_:1})]),_:1}),he.value?(U(),P($,{key:0},[],64)):D("",!0),z(E(x),{xs:24,sm:12,md:12,lg:8,xl:4,class:"text-right"},{default:G(()=>[z(E(_),null,{default:G(()=>[z(E(n),{type:"primary",onClick:Ge},{default:G(()=>[...a[10]||(a[10]=[F(" 搜索 ",-1)])]),_:1}),z(E(n),{onClick:ze},{default:G(()=>[...a[11]||(a[11]=[F(" 重置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),z(E(v),null,{default:G(()=>[M("div",A,[z(E(_),null,{default:G(()=>[z(E(n),{danger:"",onClick:Ee},{default:G(()=>[...a[12]||(a[12]=[F("清空日志",-1)])]),_:1})]),_:1})]),z(E(w),{columns:Re.value,"data-source":je.value,pagination:Ie.value,loading:T.value,rowKey:e=>e.logId,size:"middle",onChange:Ue,scroll:{x:"max-content"}},{action:G(({record:e})=>[z(E(_),{size:"middle"},{default:G(()=>[z(E(n),{type:"primary",onClick:a=>(e=>{try{Oe.value=e,ke.value=!0}catch(a){c.error("显示详情失败")}})(e),disabled:T.value},{default:G(()=>[...a[13]||(a[13]=[F(" 详情 ",-1)])]),_:1},8,["onClick","disabled"])]),_:2},1024)]),_:1},8,["columns","data-source","pagination","loading","rowKey"])]),_:1}),z(E(u),{open:ke.value,"onUpdate:open":a[6]||(a[6]=e=>ke.value=e),title:Te.value,width:"80%","max-width":1200,footer:null,destroyOnClose:!0},{default:G(()=>[Oe.value?(U(),P("div",B,[M("div",L,[M("div",K,[z(E(h).Title,{level:4,class:"m-0 text-ellipsis max-w-[70%]"},{default:G(()=>[F(J(Oe.value.jobName)+" - "+J(Oe.value.jobGroup),1)]),_:1}),z(E(p),{color:m[Oe.value.status].status,class:"text-lg px-4 py-1 text-base"},{default:G(()=>[F(J(m[Oe.value.status].text),1)]),_:1},8,["color"])]),M("div",Q,[M("div",W,[a[14]||(a[14]=M("span",{class:"font-semibold text-sm opacity-80"},"执行时长:",-1)),M("span",V,J(Oe.value.duration||0)+" ms",1)]),M("div",X,[a[15]||(a[15]=M("span",{class:"font-semibold text-sm opacity-80"},"开始时间:",-1)),M("span",Y,J(E(I)(Oe.value.startTime)),1)]),M("div",Z,[a[16]||(a[16]=M("span",{class:"font-semibold text-sm opacity-80"},"结束时间:",-1)),M("span",H,J(Oe.value.endTime?E(I)(Oe.value.endTime):"-"),1)])])]),M("div",ee,[M("div",ae,[z(E(h).Title,{level:5,class:"mb-3"},{default:G(()=>[...a[17]||(a[17]=[F("执行信息",-1)])]),_:1}),M("div",te,[M("pre",se,J(Oe.value.message||"暂无执行信息"),1)])]),Oe.value.errorMessage?(U(),P("div",le,[z(E(h).Title,{level:5,class:"mb-3"},{default:G(()=>[...a[18]||(a[18]=[F("错误信息",-1)])]),_:1}),M("div",re,[M("pre",oe,J(Oe.value.errorMessage)+"\n          ",1)])])):D("",!0),Oe.value.exception?(U(),P("div",ie,[z(E(h).Title,{level:5,class:"mb-3"},{default:G(()=>[...a[19]||(a[19]=[F("异常",-1)])]),_:1}),M("div",de,[M("pre",ne,J(Oe.value.exception),1)])])):D("",!0),Oe.value.result?(U(),P("div",ue,[z(E(h).Title,{level:5,class:"mb-3"},{default:G(()=>[...a[20]||(a[20]=[F("执行结果",-1)])]),_:1}),M("div",ce,[M("pre",me,J("string"==typeof Oe.value.result?Oe.value.result:JSON.stringify(Oe.value.result,null,2)),1)])])):D("",!0),Oe.value.jobData?(U(),P("div",pe,[z(E(h).Title,{level:5,class:"mb-3"},{default:G(()=>[...a[21]||(a[21]=[F("作业数据",-1)])]),_:1}),M("div",ve,[M("pre",fe,J("string"==typeof Oe.value.jobData?Oe.value.jobData:JSON.stringify(Oe.value.jobData,null,2)),1)])])):D("",!0)])])):D("",!0),M("div",xe,[z(E(n),{onClick:a[5]||(a[5]=e=>ke.value=!1),type:"primary",size:"large",class:"px-6"},{default:G(()=>[...a[22]||(a[22]=[F(" 关闭 ",-1)])]),_:1})])]),_:1},8,["open","title"])]),_:1}))}}),[["__scopeId","data-v-c299b9aa"]]);export{je as default};

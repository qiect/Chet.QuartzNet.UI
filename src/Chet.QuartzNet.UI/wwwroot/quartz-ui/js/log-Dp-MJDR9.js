var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,i=(e,a,t)=>new Promise((l,s)=>{var r=e=>{try{i(t.next(e))}catch(a){s(a)}},o=e=>{try{i(t.throw(e))}catch(a){s(a)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,o);i((t=t.apply(e,a)).next())});import{bW as d,a1 as u,c1 as n,ci as m}from"./bootstrap-DVYu9fpt.js";import{T as p}from"./index-BXJXR0Bj.js";import{C as c}from"./index-CSOBmJnD.js";import{F as v}from"./index-BZdQkvOC.js";import f from"./index-NMTDsBXe.js";import b from"./index-C0iUxNbO.js";import{D as j}from"./dayjs-BMlS8uyl.js";import g from"./index-DE7Q6SUu.js";import{T as x}from"./index-C_tuRoVH.js";import{T as y}from"./index-BGFc2z4V.js";import{_}from"./page.vue_vue_type_script_setup_true_lang-CJUxeVnG.js";import{a1 as w,L as h,P as T,E as O,f as k,bG as C,ai as S,aj as R,ak as I,p as N,a9 as U,as as G,an as z,aw as E,F as P,aU as D,ax as F}from"../jse/index-index-BU8xCsxV.js";import{R as $,C as M}from"./index-Df0v7Xzm.js";import"./colors-NPi0FctU.js";import"./index-DcmsOvma.js";import"./shallowequal-BxPpb1cE.js";import"./Trigger-DsfueF6c.js";import"./ResizeObserver.es-C7U_o75s.js";import"./_arrayIncludes-DqeOlflt.js";import"./Overflow-CVatm_Fz.js";import"./index-BKj9YvNs.js";import"./index-CAU6wSSv.js";import"./collapseMotion-d4vGicIB.js";import"./slide-31UNvd4m.js";import"./useRefs-BJmOiptw.js";import"./responsiveObserve-JbGWzmgT.js";import"./isMobile-VPrdNIIw.js";import"./useMergedState-9GZCOMbf.js";import"./isPlainObject-BcxriVNn.js";import"./Col-CS8peXTr.js";import"./useFlexGapSupport-D8rE8GDt.js";import"./debounce-C3SuSb1-.js";import"./FormItemContext-BbGFQEi0.js";import"./statusUtils-BZaSczs9.js";import"./BaseInput-RBOiHXEj.js";import"./index-BYo7fRZZ.js";import"./SearchOutlined-CbNBPZoP.js";import"./EyeOutlined-BNDIgaDU.js";import"./index-CjqLwoBH.js";import"./DownOutlined-RI0_aJZK.js";import"./CheckOutlined-CUZ-dwuc.js";import"./move-BRk5kYHD.js";import"./index-Cw8NlYJ8.js";import"./index-BVBbe21r.js";import"./index-wUPjjmxA.js";import"./index-NAZi48uv.js";import"./index-BkMAmwiB.js";import"./Checkbox-BobkuI7o.js";import"./index-BmoUXrQg.js";var J=(e=>(e[e.RUNNING=0]="RUNNING",e[e.SUCCESS=1]="SUCCESS",e[e.ERROR=2]="ERROR",e))(J||{});const q={class:"mb-4 flex items-center justify-end"},A={key:0,class:"log-detail"},B={class:"detail-header mb-4 rounded-lg bg-gray-50 p-4"},L={class:"mb-3 flex items-center justify-between"},K={class:"mt-2 grid grid-cols-1 gap-4 md:grid-cols-3"},Q={class:"flex items-center"},W={class:"flex items-center"},V={class:"flex items-center"},X={class:"detail-content"},Y={class:"mb-6"},Z={class:"rounded-lg border border-gray-200 bg-gray-50 p-4"},H={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm"},ee={key:0,class:"mb-6"},ae={class:"rounded-lg border border-red-200 bg-red-50 p-4"},te={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm text-red-800"},le={key:1,class:"mb-6"},se={class:"rounded-lg border border-red-200 bg-red-50 p-4"},re={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm text-red-800"},oe={key:2,class:"mb-6"},ie={class:"rounded-lg border border-blue-200 bg-blue-50 p-4"},de={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm"},ue={key:3,class:"mb-6"},ne={class:"rounded-lg border border-green-200 bg-green-50 p-4"},me={class:"word-break-break-word m-0 whitespace-pre-wrap text-sm"},pe={class:"mt-4 flex justify-end"},ce=w({__name:"log",setup(e){const w={[J.SUCCESS]:{text:"成功",status:"success"},[J.ERROR]:{text:"失败",status:"error"},[J.RUNNING]:{text:"运行中",status:"processing"}},ce=h(!1),ve=h([]),fe=h(0),be=h(1),je=h(10),ge=h(),xe=T({jobName:"",jobGroup:"",status:void 0,startTime:void 0,endTime:void 0}),ye=h(!1),_e=h(!1),we=h("日志详情"),he=h(null),Te=h(""),Oe=h(""),ke=O(()=>[{title:"作业名称",dataIndex:"jobName",ellipsis:!0},{title:"作业分组",dataIndex:"jobGroup",ellipsis:!0},{title:"状态",dataIndex:"status",customRender:({record:e})=>{const a=w[e.status];return k(p,{color:a.status},{default:()=>(null==a?void 0:a.text)||"未知"})}},{title:"开始时间",dataIndex:"startTime",ellipsis:!0,sorter:!0,sortOrder:"startTime"===Te.value?"asc"===Oe.value?"ascend":"desc"===Oe.value?"descend":void 0:void 0,customRender:({record:e})=>e.startTime?C(e.startTime):"-"},{title:"结束时间",dataIndex:"endTime",ellipsis:!0,sorter:!0,sortOrder:"endTime"===Te.value?"asc"===Oe.value?"ascend":"desc"===Oe.value?"descend":void 0:void 0,customRender:({record:e})=>e.endTime?C(e.endTime):"-"},{title:"执行时长(ms)",dataIndex:"duration",ellipsis:!0,sorter:!0,sortOrder:"duration"===Te.value?"asc"===Oe.value?"ascend":"desc"===Oe.value?"descend":void 0:void 0},{title:"操作",width:80,key:"action",fixed:"right",slots:{customRender:"action"}}]),Ce=O(()=>({current:be.value,pageSize:je.value,total:fe.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} 共 ${e} 条`,pageSizeOptions:["10","20","50","100"]})),Se=()=>i(null,null,function*(){ce.value=!0;try{const n=yield function(e){return i(this,null,function*(){return d.post("/api/quartz/GetJobLogs",e)})}((e=((e,a)=>{for(var t in a||(a={}))s.call(a,t)&&o(e,t,a[t]);if(l)for(var t of l(a))r.call(a,t)&&o(e,t,a[t]);return e})({},xe),u={pageIndex:be.value||1,pageSize:je.value||10,sortBy:Te.value,sortOrder:Oe.value},a(e,t(u))));if(n.success)n.data&&n.data.items&&Array.isArray(n.data.items)?(ve.value=n.data.items,fe.value=n.data.totalCount||0):(ve.value=[],fe.value=0);else{const e=n.errorCode?`${n.message||"获取日志列表失败"} (错误码: ${n.errorCode})`:n.message||"获取日志列表失败";m.error(e),ve.value=[],fe.value=0}}catch(n){m.error("object"==typeof n&&null!==n&&"message"in n?String(n.message):"获取日志列表失败"),ve.value=[],fe.value=0}finally{ce.value=!1}var e,u}),Re=(e,a,t)=>{void 0!==e.current&&(be.value=e.current),void 0!==e.pageSize&&(je.value=e.pageSize),void 0!==t.field&&(Te.value=t.field,Oe.value="ascend"===t.order?"asc":"descend"===t.order?"desc":""),Se()},Ie=()=>i(null,null,function*(){ge.value&&(yield ge.value.validateFields()),be.value=1,Se()}),Ne=()=>{ge.value&&ge.value.resetFields(),be.value=1,Se()},Ue=()=>{n.confirm({title:"确认清空",content:"确定要清空日志吗？此操作不可恢复！",onOk:()=>i(null,null,function*(){try{const e=yield function(){return i(this,arguments,function*(e={}){return yield d.post("/api/quartz/ClearLogs",e)})}({jobName:"",jobGroup:"",status:void 0,startTime:void 0,endTime:void 0});e.success?(m.success("日志清空成功"),yield Se()):m.error(e.message||"日志清空失败")}catch(e){m.error(e.message||"日志清空失败")}})})};return i(null,null,function*(){yield Se()}),(e,a)=>(R(),S(U(_),null,{default:I(()=>[N(U(c),{class:"mb-4"},{default:I(()=>[N(U(v),{ref_key:"searchFormRef",ref:ge,model:xe,layout:"horizontal","label-align":"right"},{default:I(()=>[N(U($),{gutter:16},{default:I(()=>[N(U(M),{xs:24,sm:12,md:12,lg:8,xl:4},{default:I(()=>[N(U(v).Item,{label:"作业名称",name:"jobName"},{default:I(()=>[N(U(f),{value:xe.jobName,"onUpdate:value":a[0]||(a[0]=e=>xe.jobName=e),placeholder:"请输入作业名称"},null,8,["value"])]),_:1})]),_:1}),N(U(M),{xs:24,sm:12,md:12,lg:8,xl:4},{default:I(()=>[N(U(v).Item,{label:"作业分组",name:"jobGroup"},{default:I(()=>[N(U(f),{value:xe.jobGroup,"onUpdate:value":a[1]||(a[1]=e=>xe.jobGroup=e),placeholder:"请输入作业分组"},null,8,["value"])]),_:1})]),_:1}),N(U(M),{xs:24,sm:12,md:12,lg:8,xl:4},{default:I(()=>[N(U(v).Item,{label:"执行状态",name:"status"},{default:I(()=>[N(U(b),{value:xe.status,"onUpdate:value":a[2]||(a[2]=e=>xe.status=e),placeholder:"请选择状态",allowClear:""},{default:I(()=>[N(U(b).Option,{value:U(J).SUCCESS},{default:I(()=>[...a[7]||(a[7]=[E("成功",-1)])]),_:1},8,["value"]),N(U(b).Option,{value:U(J).ERROR},{default:I(()=>[...a[8]||(a[8]=[E("失败",-1)])]),_:1},8,["value"]),N(U(b).Option,{value:U(J).RUNNING},{default:I(()=>[...a[9]||(a[9]=[E("运行中",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1})]),_:1}),N(U(M),{xs:24,sm:12,md:12,lg:8,xl:4},{default:I(()=>[N(U(v).Item,{label:"开始时间",name:"startTime"},{default:I(()=>[N(U(j),{value:xe.startTime,"onUpdate:value":a[3]||(a[3]=e=>xe.startTime=e),showTime:"",placeholder:"选择开始时间"},null,8,["value"])]),_:1})]),_:1}),N(U(M),{xs:24,sm:12,md:12,lg:8,xl:4},{default:I(()=>[N(U(v).Item,{label:"结束时间",name:"endTime"},{default:I(()=>[N(U(j),{value:xe.endTime,"onUpdate:value":a[4]||(a[4]=e=>xe.endTime=e),showTime:"",placeholder:"选择结束时间"},null,8,["value"])]),_:1})]),_:1}),ye.value?(R(),G(P,{key:0},[],64)):z("",!0),N(U(M),{xs:24,sm:12,md:12,lg:8,xl:4,class:"text-right"},{default:I(()=>[N(U(g),null,{default:I(()=>[N(U(u),{type:"primary",onClick:Ie},{default:I(()=>[...a[10]||(a[10]=[E(" 搜索 ",-1)])]),_:1}),N(U(u),{onClick:Ne},{default:I(()=>[...a[11]||(a[11]=[E(" 重置 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),N(U(c),null,{default:I(()=>[D("div",q,[N(U(g),null,{default:I(()=>[N(U(u),{danger:"",onClick:Ue},{default:I(()=>[...a[12]||(a[12]=[E("清空日志",-1)])]),_:1})]),_:1})]),N(U(x),{columns:ke.value,"data-source":ve.value,pagination:Ce.value,loading:ce.value,rowKey:e=>e.logId,size:"middle",onChange:Re,scroll:{x:"max-content"}},{action:I(({record:e})=>[N(U(g),{size:"middle"},{default:I(()=>[N(U(u),{type:"primary",onClick:a=>(e=>{try{he.value=e,_e.value=!0}catch(a){m.error("显示详情失败")}})(e),disabled:ce.value},{default:I(()=>[...a[13]||(a[13]=[E(" 详情 ",-1)])]),_:1},8,["onClick","disabled"])]),_:2},1024)]),_:1},8,["columns","data-source","pagination","loading","rowKey"])]),_:1}),N(U(n),{open:_e.value,"onUpdate:open":a[6]||(a[6]=e=>_e.value=e),title:we.value,width:"1000px",footer:null,destroyOnClose:!0},{default:I(()=>[he.value?(R(),G("div",A,[D("div",B,[D("div",L,[N(U(y).Title,{level:4,class:"m-0"},{default:I(()=>[E(F(he.value.jobName)+" - "+F(he.value.jobGroup),1)]),_:1}),N(U(p),{color:w[he.value.status].status,class:"text-lg"},{default:I(()=>[E(F(w[he.value.status].text),1)]),_:1},8,["color"])]),D("div",K,[D("div",Q,[a[14]||(a[14]=D("span",{class:"mr-2 font-bold"},"执行时长:",-1)),D("span",null,F(he.value.duration||0)+" ms",1)]),D("div",W,[a[15]||(a[15]=D("span",{class:"mr-2 font-bold"},"开始时间:",-1)),D("span",null,F(U(C)(he.value.startTime)),1)]),D("div",V,[a[16]||(a[16]=D("span",{class:"mr-2 font-bold"},"结束时间:",-1)),D("span",null,F(he.value.endTime?U(C)(he.value.endTime):"-"),1)])])]),D("div",X,[D("div",Y,[N(U(y).Title,{level:5,class:"mb-2"},{default:I(()=>[...a[17]||(a[17]=[E("执行信息",-1)])]),_:1}),D("div",Z,[D("pre",H,F(he.value.message||"暂无执行信息"),1)])]),he.value.errorMessage?(R(),G("div",ee,[N(U(y).Title,{level:5,class:"mb-2"},{default:I(()=>[...a[18]||(a[18]=[E("错误信息",-1)])]),_:1}),D("div",ae,[D("pre",te,F(he.value.errorMessage)+"\n          ",1)])])):z("",!0),he.value.exception?(R(),G("div",le,[N(U(y).Title,{level:5,class:"mb-2"},{default:I(()=>[...a[19]||(a[19]=[E("异常",-1)])]),_:1}),D("div",se,[D("pre",re,F(he.value.exception)+"\n          ",1)])])):z("",!0),he.value.result?(R(),G("div",oe,[N(U(y).Title,{level:5,class:"mb-2"},{default:I(()=>[...a[20]||(a[20]=[E("执行结果",-1)])]),_:1}),D("div",ie,[D("pre",de,F("string"==typeof he.value.result?he.value.result:JSON.stringify(he.value.result,null,2)),1)])])):z("",!0),he.value.jobData?(R(),G("div",ue,[N(U(y).Title,{level:5,class:"mb-2"},{default:I(()=>[...a[21]||(a[21]=[E("作业数据",-1)])]),_:1}),D("div",ne,[D("pre",me,F("string"==typeof he.value.jobData?he.value.jobData:JSON.stringify(he.value.jobData,null,2)),1)])])):z("",!0)])])):z("",!0),D("div",pe,[N(U(u),{onClick:a[5]||(a[5]=e=>_e.value=!1),type:"primary"},{default:I(()=>[...a[22]||(a[22]=[E("关闭",-1)])]),_:1})])]),_:1},8,["open","title"])]),_:1}))}});export{ce as default};

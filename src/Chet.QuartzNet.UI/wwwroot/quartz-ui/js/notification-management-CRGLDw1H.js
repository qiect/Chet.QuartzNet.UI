var d=(s,k,f)=>new Promise((B,P)=>{var w=i=>{try{O(f.next(i))}catch(g){P(g)}},h=i=>{try{O(f.throw(i))}catch(g){P(g)}},O=i=>i.done?B(i.value):Promise.resolve(i.value).then(w,h);O((f=f.apply(s,k)).next())});import{bX as S,a1 as b,ci as p,c1 as Y,bG as Z}from"./bootstrap-80w_8jBG.js";import{T as ee}from"./index-CFPCtJxs.js";import{M as R}from"./index-Bdp4Wl4-.js";import{D as te,T as ae}from"./index-Dt-a7X-w.js";import{C as _}from"./index-7wffE5Gk.js";import{F as c}from"./index-CX8GX1Sz.js";import m from"./index-BUHEG_iy.js";import N from"./index-B1iMHR1j.js";import U from"./index-DCagqh-c.js";import{_ as re}from"./page.vue_vue_type_script_setup_true_lang-DSX_pdRT.js";import{a1 as le,L as v,P as oe,E as J,f as z,bG as q,aa as se,ai as ne,aj as ie,ak as r,p as a,a9 as t,aw as u,aU as ue}from"../jse/index-index-CoTziONv.js";import{R as $,C as y}from"./index-iALcsfp2.js";import F from"./index-D-5L6OAw.js";import"./colors-PyD8LGAx.js";import"./shallowequal-DFH5zA0U.js";import"./Trigger-eGhLRbeN.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-Da9gHR3b.js";import"./index-LZGm4sFV.js";import"./index-I66FsMv8.js";import"./collapseMotion-Bvk8AQWk.js";import"./slide-BN12idjz.js";import"./index-b_-9KLvS.js";import"./index-MShVIlkP.js";import"./BaseInput-DhWPNsMO.js";import"./isMobile-8sZ0LT6r.js";import"./DownOutlined-B6SIMpou.js";import"./CheckOutlined-DAAfGYoH.js";import"./SearchOutlined-Ch_ZV1bX.js";import"./move-Bs9cZOkJ.js";import"./index-_YUbsMUb.js";import"./index-CqgFd8gG.js";import"./responsiveObserve-XrlR7Ap8.js";import"./index-DJx1RU7v.js";import"./useMergedState-BKYVkle_.js";import"./index-IEJsFQhH.js";import"./Checkbox-BPxbEnRZ.js";import"./FormItemContext-UbnTJu-x.js";import"./index-CtBxO5dw.js";import"./debounce-78PzSyts.js";import"./useRefs-B6P04HQ_.js";import"./isPlainObject-D81FD9AK.js";import"./Col-DmR1hfNA.js";import"./useFlexGapSupport-Dlsy5dTm.js";import"./statusUtils-BJs1s8jU.js";import"./EyeOutlined-FqHQHeH3.js";var I=(s=>(s[s.Pending=0]="Pending",s[s.Sent=1]="Sent",s[s.Failed=2]="Failed",s))(I||{});const de=()=>d(null,null,function*(){return yield S.get("/api/quartz/GetPushPlusConfig")}),pe=s=>d(null,null,function*(){return yield S.post("/api/quartz/SavePushPlusConfig",s)}),me=()=>d(null,null,function*(){return yield S.post("/api/quartz/SendTestNotification")}),fe=s=>d(null,null,function*(){return yield S.post("/api/quartz/GetNotifications",s)}),ce=s=>d(null,null,function*(){return yield S.delete("/api/quartz/DeleteNotification",{params:{notificationId:s}})}),ve=s=>d(null,null,function*(){return yield S.post("/api/quartz/ClearNotifications",s)}),ge={class:"mb-4 flex items-center justify-between"},ye=le({__name:"notification-management",setup(s){const k={[I.Pending]:{text:"待发送",status:"default"},[I.Sent]:{text:"发送成功",status:"success"},[I.Failed]:{text:"发送失败",status:"error"}},f=v(!1),B=v([]),P=v(0),w=v(1),h=v(10),O=v(),i=v({status:void 0,triggeredBy:""}),g=v(""),x=v(void 0),T=v(!1),D=v("通知配置"),n=oe({token:"",channel:"wechat",template:"html",topic:"",enable:!1,strategy:{notifyOnJobSuccess:!1,notifyOnJobFailure:!0,notifyOnSchedulerError:!0}}),M=v(),G=J(()=>[{title:"通知标题",dataIndex:"title",ellipsis:!0,sorter:!0,sortOrder:g.value==="title"?x.value:void 0},{title:"触发来源",dataIndex:"triggeredBy",ellipsis:!0,sorter:!0,sortOrder:g.value==="triggeredBy"?x.value:void 0},{title:"状态",dataIndex:"status",ellipsis:!0,customRender:({record:l})=>{const e=k[l.status];return{children:z(ee,{color:(e==null?void 0:e.status)||"default"},(e==null?void 0:e.text)||l.status||"未知")}}},{title:"创建时间",dataIndex:"createTime",ellipsis:!0,sorter:!0,sortOrder:g.value==="createTime"?x.value:void 0,customRender:({record:l})=>({children:l.createTime?q(l.createTime):"-"})},{title:"发送时间",dataIndex:"sendTime",ellipsis:!0,sorter:!0,sortOrder:g.value==="sendTime"?x.value:void 0,customRender:({record:l})=>({children:l.sendTime?q(l.sendTime):"-"})},{title:"耗时(ms)",dataIndex:"duration",ellipsis:!0,sorter:!0,sortOrder:g.value==="duration"?x.value:void 0},{title:"操作",key:"action",width:80,customRender:({record:l})=>{const e=z(R.Item,{onClick:()=>Q(l),danger:!0},"删除"),o=z(R,null,[e]),W=z(b,{type:"primary",disabled:f.value},"操作");return{children:z(te,{trigger:["click"],overlay:o},()=>W)}}}]),V=J(()=>({current:w.value,pageSize:h.value,total:P.value,showSizeChanger:!0,showQuickJumper:!0,showTotal:(l,e)=>`${e[0]}-${e[1]} 共 ${l} 条`,pageSizeOptions:["10","20","50","100"]})),j=(l,e,o)=>{l.current!==void 0&&(w.value=l.current),l.pageSize!==void 0&&(h.value=l.pageSize),o.field!==void 0&&(g.value=o.field,x.value=o.order==="ascend"?"ascend":o.order==="descend"?"descend":void 0),C()},C=()=>d(null,null,function*(){var l,e;f.value=!0;try{const o=yield fe({pageIndex:w.value,pageSize:h.value,status:i.value.status,triggeredBy:i.value.triggeredBy,sortBy:g.value,sortOrder:x.value});B.value=((l=o.data)==null?void 0:l.items)||[],P.value=((e=o.data)==null?void 0:e.totalCount)||0}catch(o){p.error("获取通知列表失败"),console.error("获取通知列表失败:",o)}finally{f.value=!1}}),L=()=>d(null,null,function*(){O.value&&(yield O.value.validateFields()),w.value=1,C()}),K=()=>{i.value={status:void 0,triggeredBy:""},w.value=1,C()},X=()=>d(null,null,function*(){try{const l=yield de();Object.assign(n,l.data),T.value=!0}catch(l){p.error("获取配置失败"),console.error("获取配置失败:",l)}}),E=()=>d(null,null,function*(){if(M.value)try{yield M.value.validateFields(),f.value=!0;const l=yield pe(n);l.success?(p.success("配置保存成功"),T.value=!1):p.error(l.message||"配置保存失败")}catch(l){if(l.errorFields)return;const e=l.message||"配置保存失败";p.error(e),console.error("保存配置失败:",l)}finally{f.value=!1}}),H=()=>d(null,null,function*(){try{f.value=!0;const l=yield me();l.success?(p.success("测试通知发送成功"),C()):p.error(l.message||"测试通知发送失败")}catch(l){p.error("测试通知发送失败"),console.error("发送测试通知失败:",l)}finally{f.value=!1}}),Q=l=>d(null,null,function*(){try{const e=yield ce(l.notificationId);e.success?(p.success("通知删除成功"),C()):p.error(e.message||"通知删除失败")}catch(e){p.error("通知删除失败"),console.error("删除通知失败:",e)}}),A=()=>d(null,null,function*(){try{const l=yield ve({pageIndex:1,pageSize:1,status:i.value.status,triggeredBy:i.value.triggeredBy});l.success?(p.success("通知清空成功"),C()):p.error(l.message||"通知清空失败")}catch(l){p.error("通知清空失败"),console.error("清空通知失败:",l)}});return se(()=>{C()}),(l,e)=>(ie(),ne(t(re),null,{default:r(()=>[a(t(_),{class:"mb-4"},{default:r(()=>[a(t(c),{ref_key:"searchFormRef",ref:O,model:i.value,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18},"label-align":"right"},{default:r(()=>[a(t($),{gutter:16},{default:r(()=>[a(t(y),{xs:24,sm:12,md:8,lg:8},{default:r(()=>[a(t(c).Item,{label:"通知状态",name:"status"},{default:r(()=>[a(t(m),{value:i.value.status,"onUpdate:value":e[0]||(e[0]=o=>i.value.status=o),placeholder:"请选择状态",allowClear:""},{default:r(()=>[a(t(m).Option,{value:t(I).Pending},{default:r(()=>[...e[13]||(e[13]=[u("待发送",-1)])]),_:1},8,["value"]),a(t(m).Option,{value:t(I).Sent},{default:r(()=>[...e[14]||(e[14]=[u("发送成功",-1)])]),_:1},8,["value"]),a(t(m).Option,{value:t(I).Failed},{default:r(()=>[...e[15]||(e[15]=[u("发送失败",-1)])]),_:1},8,["value"])]),_:1},8,["value"])]),_:1})]),_:1}),a(t(y),{xs:24,sm:12,md:8,lg:8},{default:r(()=>[a(t(c).Item,{label:"触发来源",name:"triggeredBy"},{default:r(()=>[a(t(N),{value:i.value.triggeredBy,"onUpdate:value":e[1]||(e[1]=o=>i.value.triggeredBy=o),placeholder:"请输入触发来源"},null,8,["value"])]),_:1})]),_:1}),a(t(y),{xs:24,sm:24,md:24,lg:8,class:"text-right"},{default:r(()=>[a(t(U),null,{default:r(()=>[a(t(b),{type:"primary",onClick:L},{default:r(()=>[...e[16]||(e[16]=[u("搜索",-1)])]),_:1}),a(t(b),{onClick:K},{default:r(()=>[...e[17]||(e[17]=[u("重置",-1)])]),_:1}),a(t(b),{danger:"",onClick:A},{default:r(()=>[...e[18]||(e[18]=[u("清空",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(t(_),null,{default:r(()=>[ue("div",ge,[a(t(U),null,{default:r(()=>[a(t(b),{type:"primary",onClick:X},{default:r(()=>[...e[19]||(e[19]=[u("通知配置",-1)])]),_:1}),a(t(b),{type:"default",onClick:H},{default:r(()=>[...e[20]||(e[20]=[u("发送测试通知",-1)])]),_:1})]),_:1})]),a(t(ae),{columns:G.value,"data-source":B.value,pagination:V.value,loading:f.value,rowKey:o=>o.notificationId,onChange:j,size:"middle",scroll:{x:"max-content"}},null,8,["columns","data-source","pagination","loading","rowKey"])]),_:1}),a(t(Y),{visible:T.value,"onUpdate:visible":e[11]||(e[11]=o=>T.value=o),title:D.value,width:"800px","body-style":{padding:"24px"},destroyOnClose:"",onCancel:e[12]||(e[12]=o=>T.value=!1)},{footer:r(()=>[a(t(U),null,{default:r(()=>[a(t(b),{onClick:e[10]||(e[10]=o=>T.value=!1)},{default:r(()=>[...e[29]||(e[29]=[u("取消",-1)])]),_:1}),a(t(b),{type:"primary",onClick:E},{default:r(()=>[...e[30]||(e[30]=[u("保存",-1)])]),_:1})]),_:1})]),default:r(()=>[a(t(c),{ref_key:"formRef",ref:M,model:n,layout:"horizontal","label-col":{span:6},"wrapper-col":{span:18},"label-align":"right"},{default:r(()=>[a(t($),{gutter:16},{default:r(()=>[a(t(y),{xs:24,sm:24,md:24},{default:r(()=>[a(t(c).Item,{label:"是否启用",name:"enable",valuePropName:"checked"},{default:r(()=>[a(t(F),{checked:n.enable,"onUpdate:checked":e[2]||(e[2]=o=>n.enable=o)},null,8,["checked"])]),_:1})]),_:1}),a(t(y),{xs:24,sm:24,md:24},{default:r(()=>[a(t(c).Item,{label:"Token",name:"token",rules:[{required:n.enable,message:"请输入PushPlus Token"}]},{default:r(()=>[a(t(N),{value:n.token,"onUpdate:value":e[3]||(e[3]=o=>n.token=o),placeholder:"请输入PushPlus Token"},null,8,["value"])]),_:1},8,["rules"])]),_:1}),a(t(y),{xs:24,sm:24,md:24},{default:r(()=>[a(t(c).Item,{label:"推送渠道",name:"channel"},{default:r(()=>[a(t(m),{value:n.channel,"onUpdate:value":e[4]||(e[4]=o=>n.channel=o)},{default:r(()=>[a(t(m).Option,{value:"wechat"},{default:r(()=>[...e[21]||(e[21]=[u("微信",-1)])]),_:1}),a(t(m).Option,{value:"cp"},{default:r(()=>[...e[22]||(e[22]=[u("企业微信",-1)])]),_:1}),a(t(m).Option,{value:"webhook"},{default:r(()=>[...e[23]||(e[23]=[u("钉钉",-1)])]),_:1}),a(t(m).Option,{value:"mail"},{default:r(()=>[...e[24]||(e[24]=[u("邮件",-1)])]),_:1}),a(t(m).Option,{value:"sms"},{default:r(()=>[...e[25]||(e[25]=[u("短信",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(t(y),{xs:24,sm:24,md:24},{default:r(()=>[a(t(c).Item,{label:"消息模板",name:"template"},{default:r(()=>[a(t(m),{value:n.template,"onUpdate:value":e[5]||(e[5]=o=>n.template=o)},{default:r(()=>[a(t(m).Option,{value:"html"},{default:r(()=>[...e[26]||(e[26]=[u("HTML",-1)])]),_:1}),a(t(m).Option,{value:"text"},{default:r(()=>[...e[27]||(e[27]=[u("TEXT",-1)])]),_:1}),a(t(m).Option,{value:"markdown"},{default:r(()=>[...e[28]||(e[28]=[u("Markdown",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),a(t(y),{xs:24,sm:24,md:24},{default:r(()=>[a(t(c).Item,{label:"主题",name:"topic"},{default:r(()=>[a(t(N),{value:n.topic,"onUpdate:value":e[6]||(e[6]=o=>n.topic=o),placeholder:"请输入主题（可选）"},null,8,["value"])]),_:1})]),_:1}),a(t(y),{xs:24,sm:24,md:24},{default:r(()=>[a(t(c).Item,{label:"通知策略",class:"mt-4"},{default:r(()=>[a(t(c).Item,{label:"作业成功时发送",name:"strategy.notifyOnJobSuccess",valuePropName:"checked"},{default:r(()=>[a(t(F),{checked:n.strategy.notifyOnJobSuccess,"onUpdate:checked":e[7]||(e[7]=o=>n.strategy.notifyOnJobSuccess=o)},null,8,["checked"])]),_:1}),a(t(c).Item,{label:"作业失败时发送",name:"strategy.notifyOnJobFailure",valuePropName:"checked"},{default:r(()=>[a(t(F),{checked:n.strategy.notifyOnJobFailure,"onUpdate:checked":e[8]||(e[8]=o=>n.strategy.notifyOnJobFailure=o)},null,8,["checked"])]),_:1}),a(t(c).Item,{label:"调度器异常时发送",name:"strategy.notifyOnSchedulerError",valuePropName:"checked"},{default:r(()=>[a(t(F),{checked:n.strategy.notifyOnSchedulerError,"onUpdate:checked":e[9]||(e[9]=o=>n.strategy.notifyOnSchedulerError=o)},null,8,["checked"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])]),_:1}))}}),ft=Z(ye,[["__scopeId","data-v-b11ffed7"]]);export{ft as default};
